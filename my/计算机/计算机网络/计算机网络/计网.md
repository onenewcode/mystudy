# 计算机网络概述
## 互联网概述
**计算机网络**（简称为网络）由若干节点(node评和连接这些节点的链路(link) 组成。网络中的节点可以是计算机、集线器、交换机或路由器等。
网络把许多计算机连接在一起，而互连网则把许多网络通过一些路由器连接在一起。与网络相连的计算机常称为主机。
互联网服务提供者 ISP (Interne t Service Prov der) 。任何机构和个人只要向某个 ISP 交纳规定的费用，就可从该 ISP 获取所需 IP 地址的租用权，并可通过该 ISP 接入互联网.
**ISP 也分为不同层次**
ISP: 主干 ISP 、地区 ISP 和本地 ISP 。目前已经覆盖全球的互联网，其主干 ISP 只有十几个，但本地 ISP 有好几十万个。
<img src="img\屏幕截图 2022-12-05 205144.png">

互联网交换点 IXP 的主要作用就是允许两个网络直接相连并交换分组，而不需要再通过第三个网络来转发分组。IXP 常采用工作在数据链路层的网络交换机，这些网络交换机都用局域网互连起来。
RFC (Request For Commen s) 的意思就是“请求评论
## 互联网的组成
互联网的拓扑结构虽然非常复杂，并且在地理上覆盖了全球，但从其
工作方式上看，可以划分为以下两大块： 视频讥解
(1) **边缘部分** 由所有连接在互联网上的主机组成。这部分是用户直接使用的，用来进行通信（传送数据、音频或视频）和资源共享。
(2) **核心部分** 由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服S务的（提供连通性和交换）。
<img src="img\屏幕截图 2022-12-05 210312.png">

###  互联网的边缘部分
处在互联网边缘的部分就是连接在互联网上的所有的主机。这些主机又称为端系统(endsystem).边缘部分利用核心部分所提供的服务，使众多主机之间能够互相通信并交换或共享信息。
在网络边缘的端系统之间的通信方式通常可划分为两大类：客户－服务器方式 (C/S式）和对等方式 (P2P 方式) 
**客户－服务器方式**
**客户程序：**
(I) 被用户调用后运行，在通信时屯动向远地服务器发起通信信（请求服务）。因此，客户程序必须知道服务器程序的地址。
(2) 不需要特殊的硬件和很复杂的橾作系统。
**服务器程序：**
(l)一种专门用来提供某种服务的程序，可同时处理多个远地或本地客户的讲求。
(2) 系统启动不断地运行，被动地等待并接受来自各地的吝户的通信请求。服务器程序不而要知追客户程序的地址。
(3) 一般需要要有强大的硬件和高级的操作系统支持。
**对等方式连接**
指两台主机在通信时，并不区分哪一个是服务请求方和哪一个是服务提供方。只要两台主机都运行了对等连接软件 (P2P 软件），它们就可以进行平等的对等连接通信。这时，双方都可以下载对方已经存储在硬盘中的共享文档。
### 互联网的核心部分
网络核心部分是互联网中最复杂的部分，因为网络中的核心部分要向网络边缘部分中的大量主机提供连通性，使边缘部分中的任何一台主机都能够与其他中机通信。在网络核心部分起特殊作用的是路由器（ rou er), 它是一种专用计算机（但不叫作主机）。路由器是实现分组交换(packe switch g)的关键构件，其任务是转发收到的分组，
1. **电路交换的主要特点**
<img src="img\屏幕截图 2022-12-05 221708.png">

电路交换需要建立专用的物理通道并且是在通话的全部时间内，通话的两个用户始终占用端到端的通信资源。
<img src="img\屏幕截图 2022-12-05 222135.png">

当使用电路交换来传送计算机数据时，其线路的传输效率往往很低。这是
因为计算机的数据是突发式地出现在传输线路的
2. **分组交换的主要特点**
分组交换则采用存储转发技术。一个报文划分为儿个分组后内进行传送。通常我们把要发送的整块数据称为一个报文(message)在发送报文之前，先把较长的报文划分为一个个吏小的等长数据段，每个数据段为 1024 it®。在每一个数据段前而，加上一些必要的控制信息组成的首部(header) 后，就构成了一个分组(packet) 分组又称为“包”，而分组的首部也可称为“包头”·分组是在互联网中传送的数据单元。
**主机是为用户进行信息处理的，并且可以和其他 机通过网络交换估息。路由器则用来转发分组，即进行分组交换。**
分组交换示意图
<img src="img\屏幕截图 2022-12-05 223127.png">

分组交换优点
|优点| 所采用的手段|
|--------------|------------------|
|高效| 在分组传输的过程中动态分化传输带宽，对通信链路逐段占用
|灵活| 为每一个分组独立地选择合适的转发路由
|迅速 |以分组作为传送单位，不先建立连接就能向其他主机发送分组
|可靠 |保证可靠性的网络协议 分布式多路由的分组交换网．使网络有很好的生存性

## 计算机网络类别
### 按照网络的作用范图进行分类
1. **广域网 WAN (Wide Area Network)** 广域网的作用范围通常为几十到几千公里。因而有时也称为远程网(lon haul network) 。广域网是互联网的核心部分，其任务是长距离（例如，跨越不同的国家）运送主机所发送的数据。
2. **城域网 MAN (Metropolitan Area Network)** 城域网的作用范围一般是一个城市，可跨越几个街区甚至整个城市，其作用距离约为 5~50 km 。城域网可以为一个或几个单位所拥有，也可以是一种公用设施，用来将多个局域网进行互联。目前很多城域网采用的是以太网技术，因此有时也常并入局域网的范围进行讨论。
3. **局域网 LAN (Local Area Network)** 局域网一般用微型计算机或工作站通过高速通信线路相连（速率通常在 10 Mbit/ 以上），但地理上则局限在较小的范围（如 km 左右）。
4. **个人区域网 PAN (Personal Area Network)** 个人区域网就是在个人工作的地方把属于个人使用的电子设备（如便携式电脑等）用无线技术连接起来的网络，因此也常称为无线个人区域网 WPAN (Wireless PAN)。

### 按照网络的使用者进行分类
1. 公用网(publ network) 这是指电信公司（国有或私有）出资建造的大型网络。
2. 专用网(priva network) 这是某个部门为满足本单位的特殊业务工作的需要而建造的网络。这种网络不向本单位以外的人提供服务。

###  用来把用户接入到互联网的网络
这种网络就是接入网 AN (Access Ne work), 它又称为本地接入网或居民接入网。这是一类比较特殊的计算机网络。用户必须通过本地 ISP 才能接入到互联网。本地 ISP 可以使用多种接入网技术把用户的端系统连接到互联网。接入网实际上就是本地 ISP 所拥有的网络，它既不是互联网的核心部分，也不是互联网的边缘部分。接入网由某个端系统连接到本地 ISP 的第一个路由器（也称为边缘路由器）之间的一些物理链路所组成。从覆盖的范围看，其长度在几百米到几公里之间。很多接入网还是属于局域网。
## 计算机网络性能
### **计算机网络的性能指标**
1. **速率**网络的速率时，往往指的是额定速率或标称速率
2. **带宽**
（1）带宽本来是指某个信号具有的频带宽度，带宽的单位是赫
（2）在计算机网络中，带宽用来表示网络中某通道传送数据的能力，因此网络带宽表示在单位时间内网络中的某信道所能通过的“最高数据率”。
3. **吞吐量**
吞吐量（throu t)表示在单位时间内通过某个网络（或信递、接口）的实际数据量。
4. **时延**
时延（delay或 latency)是指数据（一个报文或分组，甚至比特）从网络（或链路）的一端传送到另一端所需的时间。
(1) 发送时延 发送时延（transm ss on delay)是主机或路由器发送数据帧所需要的时间，
发送时延的计算公式是：发送时延＝数据帧长度(bit)/发送速率(b it/s)
(2) 传播时延 传播时延（pro tion delay)是电磁波在信道中传播一定的距离需要花 费的时间。传播时延的计赁公式是：
传播时延＝ 信道长度(m)/电磁波在信道上的传播速率(m/s）
(3) 处理时延 主机或路由器在收到分组时要花费一定的时间进行处理，
(4) 排队时延 分组在经过网络传输时，要经过许多路由器。但分组在进入路由器后要先在输入队列中排队等待处理。在路由器确定了转发接口后，还要在输出队列中排队等待转发。
5. **时延带宽积**
时延带宽积＝传播时延*带宽
6. **往返时间 RTT**
7. **利用率**
利用率有信道利用率和网络利用率两种。
信道利用率指出某信道有百分之几的时间是被利用的（有数据通过）。
网络利用率则是全网络的信道利用率的加权平均值。
如果令D0表示网络空闲时的时延，D表示网络当前的时延（设现在的网络利用率为 U), 那么在适当的假定条件下，可以用下而的简单公式(1-5)
D=D0/1-U
<img src="img\屏幕截图 2022-12-06 090051.png">

### 计算机网络的非性能特征
1. 费用
网络的价格（包括设计和实现的费用）总是必须考虑的。
2. 质量
网络的质扯取决千网络中所有构件的质量，以及这些构件是怎样组成网络的。网络的质散影响到很多方面，如网络的可靠性、网络管理的简易性，以及网络的一些性能。
3. 标准化
网络的硬件和软件的设计既可以按照通用的国际标准，也可以逍循特定的专用网络标准。
4. 可靠性
5. 可扩展性和可升级性
6. 易千管理和维护
## 计算机网络体系结构
### 计钵机网络体系结构的形成
通信间存在的问题
1. 发起通信的计算机必须将数据通信的迪路激活(activate) 。所叫“激活”就是要发出一些信令，保证要传送的计算机数据能在这条通路上正确发送和接收。
2. 告诉网络如何识别接收数据的计算机。
3. 发起通信的计算机必须查明对方计算机是否已开机，并且与网络连接正常。
4. 发起通信的计算机中的应用程序必须弄清楚，在对方计算机中的文件管理程序是否己做好接收文件和存储文件的准备工作。
5. 若计算机的文件格式不兼容，则至少其中一台计算机应完成格式转换功能。
6.  对出现的各种差错和意外事故，如数据传送错误、重复或丢失，网络中某个节点交换机出现故陷等，应当有可靠的措施保证对方计符机最终能够收到正确的文件。

### 具有五层协议的体系结构

<img src="img\屏幕截图 2022-12-06 093605.png">

1. **应用层(application layer)** 
应用层的任务是通过应用进程间的交互来完成特定网络应用。应用层协议定义的是应用进程间通信和交互的规则。
2. **运输层（transport layer)** 
运输层的任务就是负责向两台主机中进程之间的通信提供通用的数据传输服务。应用进程利用该服务传送应用层报文。所谓“通用的“，是指并不针对某个特定网络应用，而是多种应用可以使用同一个运输层服务。由于一台主机可同时运行多个进程，因此运输层有复用和分用的功能。
运输层主要使用以下两种协议：
• 传输控制协议 TCP (Transmission Control Pro ocol}-—才是供面向连接的、可靠的数
据传输服务，其数据传输的单位是报文段(se men t)。
• 用户数据报协议 UDP (User Datagram Pro ocol)--提供无连接的尽最大努力 (bestff rt)的数据传输服务（不保证数据传输的可靠性），其数据传输的单位是用户数据报。
3. **网络层(network layer)** 
网络层负责为分组交换网上的不同主机提供通信服务。在发送数据时，网络层把运输层产生的报文段或用户数据报封装成分组或包进行传送。在 TCP/IP 体系中，由于网络层使IP 协议，因此分组也叫作 IP 数据报，或简称为数据报。
网络层的具体任务有两个。第一个任务是通过一定的算法，在互联网中的每一个路由器上生成一个用来转发分组的转发表。第二个任务较为简单，就是每一个路由器在接收到一个分组时，依据转发表中指明的路径把分组转发到下一个路由器。这样就可以使源主机运输层所传下来的分组，能够通过合适的路由最终到达目的主机。
4. **数据链路层(data link layer)** 
数据链路层常简称为链路层。我们知道，两台主机之间的数据传输，总是在一段一段的链路上传送的，这就需要使用专门的链路层的协议。在两个相邻节点之间传送数据时，数据链路层将网络层交下来的 IP 数据报组装成帧(fram g),在两个相邻节点间的链路上传送帧（frame) 。每一帧包括数据和必要的控制信息（如同步信息、地址信息、差错控制等）。
5. **物理层(physical layer)** 
在物理层上所传数据的单位是比特。发送方发送 （或 O) 时，接收方应当收到 （或0) 而不是 （或 l) 。因此物理层要考虑用多大的电压代表 ”1 "或 “O", 以及接收方如何识别出发送方所发送的比特。物理层还要确定连接电缆的插头应当有多少根引脚以及各引脚应如何连接
<img src="img\屏幕截图 2022-12-06 094847.png">

### 实体、协议、服务和服务访问点
**协议数据单元 PDU**
**服务数据单元 SDU(Service Data Unit)**
**为服务访问点SAP (Service Access Point)**

**实体(entity)** 这一较为抽象的名词表示任何可发送或接收信息的硬件或软件进程。在许多悄况下，实体就是一个特定的软件模块。
**协议**是控制两个对等实体（或多个实体）进行通信的规则的集合

在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务。要实现本层协议，还需要使用下面一层所提供的服务。，协议的实现保证了能够向上一层提供服务。使用本层服务的实体只能看见服务而无法看见下面的协议。也就是说，下面的协议对上面的实体是透明的。
协议是“水平的＂，即协议是控制对等实体之间通倍的规则。但服务是“垂直的＂
<img src="img\屏幕截图 2022-12-06 095802.png">

### TCP/I 的体系结构
<img src="img\屏幕截图 2022-12-06 104951.png">

<img sec="img\屏幕截图 2022-12-06 105102.png">
还反映出互联网的一个十分益要的设计理念，这就是网络的核心部分
越简单越好，把一切复杂的部分让网络的边缘部分去实现。

# 物理层
## 物理层的基本概念
物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流
用千物理层的协议也常称为物理层规程(procedure) 。其实物理层规程就是物理层协议。
**接口特性**
1. 机械特性 指明接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装置等。平时常见的各种规格的接插件都有严格的标准化的规定。
2. 电气特性 指明在接口电缆的各条线上出现的电压的范围。
3. 功能特性 指明某条线上一出现的某一电平的电压的意义。
4. 过程特性 指明对丁不同功能的各种可能事件的出现顺序。
## 数据通信的基础知识
### 数据通信系统的模型
一个数据通信系统可划分为三大部分，即源系统（或发送端、发送方）、传输系统（或传输网络）和目的系统（或接收端、接收方）。
<img src="img\屏幕截图 2022-12-06 110056.png" >

源系统一般包括以下两个部分：
• 源点(source) 源点设备产生要传输的数据，例如，从计算机的键盘输入汉字，计算机产生输出的数字比特流。源点又称为源站或信源。
• 发送器 通常源点生成的数字比特流要通过发送器编码后才能够在传输系统中进行传输。典型的发送器就是调制器。现在很多计算机使用内置的调制解调器（包含调制器和解调器），用户在计算机外面看不见调制解调器。
目的系统一般也包括以下两个部分：
• 接收器 接收传输系统传送过来的信号，并把它转换为能够被目的设备处理的信息。典型的接收器就是解调器，它把来自传输线路上的模拟信号进行解调，提取出在发送端置入的消息，还原出发送端产生的数字比特流。
• 终点(desti nati on) 终点设备从接收器获取传送来的数字比特流，然后把信息息输出终点又称为目的站或信宿。
根据信号中代表消息的参数的取俏方式不同，估号可分为以下两大类：
1. 拟信号，或连续信号一代表消息的参数的取值是连续的。
2. 数字信号，或离散信号一代表消息的参数的取值是离散的
### 有关信道的几个基本概念
1. 单向通信 又称为单工通信，即只能有一个方向的通信而没有反方向的交互。
2. 双向交替通信 又称为半双工通信，即通信的双方都可以发送信息，但不能双方同时发送（当然也就不能同时接收）。。
3. 双向同时通信 又称为全双工通信，即通信的双方可以同时发送和接收信息

来自信源的信号常称为基带信号（即基本频带信号）。基带信号往往包含较多的低频分量或直流分量，而许多信道并不能传输这种分量。为了解决这一问题，就必须对基带信号进行**调制(modulation)**
调制可分为两大类。 －类是仅仅对基带信号的波形进行变换，使它能够与信道特性相适应。这类调制称为基带调制．由于这种基带调制是把数字
信号转换为另一种形式的数字信号，因此大家更愿总把这种过程称为编码(coding)。另一类调制则需要使用载波（carrier)进行调制，把基带信号的频率范围搬移到较高的频段，并转换为模拟信号，这样就能够更好地在模拟信道中传输。经过载波调制后的信号称为带通信号，而使用载波的调制称为带通调制。

(I) 常用编码方式
<img src="img\屏幕截图 2022-12-06 111147.png">

(2) 基本的带通调制方法
<img src="img\屏幕截图 2022-12-06 111243.png">

### 信道的极限容揽
数字通信的优占：虽然信号号在信道上传 输时会不可避免地产生失真
1. 信道能够通过的频率范围
具体的信道所能通过的频率范围总是有限的。
在带宽为W(Hz) 的低通信道中，若不考虑噪声影响，则码元传输的最高速率是 2W （码元／秒）。传输速率超过此上限，就会出现严重的码
间串扰的问题，使接收端对码元的判决（即识别）成为不可能。
2. 信噪比
所谓信噪比就是信号的平均功率和噪声的平均功率之比，常记为 S/N
信噪比(dB) = 10 log10(S/N) (dB)
香农公式指出信道的极限信息传输速率C = W log2(1+SIN) (bit/s)
## 物理层下面的传输媒体
传输媒体也称为传输介质或传输媒介，它就是数据传输系统中在发送器和接收器之间的物理通路。传输媒体可分为两大类，即导引型传输媒体和非导引型传输媒体
### 导引型传输媒体
1.  **双绞线**
把两根互相绝缘的铜导线并排放在一起，然后用规则的方法绞合(twist)起来就构成了双绞线。绞合可减少对相邻导线的电磁干扰。
无屏蔽双绞线 UTP (Unsh ielded Twisted Pa r) （如图 2-6(a)所示）的价格较便宜。当数据的传送速率增高时，可以采用屏蔽双绞线 (Sh elded Twisted Pa r, 简称为 STP) 。
<img src="img\屏幕截图 2022-12-06 113254.png">

常用双绞线类别
|绞合线类别 |带宽 |线缆特点| 典型应用|
|--------------|----------|-----------|--------------|
|3 |16 MHz |芯双绞线 |校拟电话：传统以太网(10 Mbit/s) |
|5 |100 MHz |与3类相比增加绞合度 传输速率 100 Mbit/ （距宽 100 m) 
|5E （超5类） |125 MHz |与5类相比衰减更小| 1Gb（距离 1OOm)
|6 |250 MHz| 改善串扰性能．可使用屏蔽双绞线 |传输逑率 1O Gbit/s （距离 35~55 m) 
|6A |500 MHz| 改善串扰性能．可使用屏蔽双绞线| 传输速率 10 Gbit/s （距离 100 m) 
|7 |600Mhz| 必须使用屏蔽双绞 |传输速超过 1OGbit/s, 距离 IOOm
| 8| 2000 MHz |必须使用屏蔽双绞线|25 Gbit或40 Gbit/s, 距离 30m
无论是哪种类别的双绞线，衰减都随频率的升高而增大。使川更租的导线可以减小衰减，但却增加了导线的重品和价格。信号应当有足够大的振幅，以便在噪卢干扰下能够在接收端正确地被检测出来。双绞线的最高速率还与数字估号的编码方法有很大的关系。
2. **同轴电缆**
同轴电缆由内导体铜质芯线（单股实心线或多股绞合线）、绝缘层、网状编织的外导体屏蔽层（也可以是单股的）以及绝缘保护套层所组成（如图 2-7 所示）。由于外导体屏蔽层的作用，同轴电缆具有很好的抗干扰特性.
<img src="img\屏幕截图 2022-12-06 140036.png">

3. 光缆
光纤通信就是利用光导纤维（以下简称为光纤）传递光脉冲来进行通信的。有光脉冲相当于 ，而没有光脉冲相当于 。由于可见光的频率非常高，约为 10^8 MHz 的量级
<img src="img\屏幕截图 2022-12-06 140421.png">

光纤
<img src="img\屏幕截图 2022-12-06 142328.png">

光纤不仅具有通信容量非常大的优点，而且还具有其他的一些特点：
(I) 传输损耗小，中继距离长，对远距离传输特别经济。
(2) 抗雷电和电磁千扰性能好。这在有大电流脉冲干扰的环境下尤为重要。
(3) 无串音干扰，保密性好，也不易被窃听或截取数据。
(4) 体积小，重量轻。这在现有电缆节道已拥塞不堪的情况下特别有利。

### 非引导型传输媒体
无线电微波通信在当前的数据通信中占有特殊重要的地位
在使用微波频段的无线蜂窝通信系统中，有时基站向手机发送的信号被障碍物阻挡了，无法直接到达手机。但基站发出的信号可以经过多个障碍物的数次反射到达手机
<img src="img\屏幕截图 2022-12-06 142929.png">

为实现远距离通信必须在一条微波通信信道的两个终端之间建立若干个中继站。中继站把前一站送来的信号经过放大后再发送到下一站，这种通信方式称为“微波接力”。
微波接力通信可传输电话、电报、图像、数据等信息。其主要特点是：
1. 微波波段频率很高，其频段范围也很宽，因此其通信信道的容量很大。
2. 因为工业干扰和天电干扰的主要频谱成分比微波频率低得多，对微波通信的危害比对短波和米波（即甚高频）通信小得多，因而微波传输质量较高。
3. 与相同容量和长度的电缆载波通信比较，微波接力通信建设投资少见效快，易跨越山区、江河。
当然，微波接力通信也存在如下的一些缺点：
1. 相邻站之间必须直视常称为视距 LOS (Line Of ig t)),不能有障碍物。有时一个天线发射出的信号也会分成几条略有差别的路径到达接收天线，因而造成失真。
2. 微波的传播有时也会受到恶劣气候的影响。
3. 与电缆通信系统比较，微波通信的隐蔽性和保密性较差。
4. 对大量中继站的使用和维护要耗费较多的人力和物力。

## 信道复用技术
最基本的复用就是频分复用 FDM (Frequence Division Multiplexing)和时分复用 TDM(Time Division Multiplexing)。频分复用的概念是这样的。例如，有N路信句号在一个信道中传送。可以使用调制的方法，把各路信号分别搬移到适当的频率位置，使彼此不产生干扰，
时分复用则是将时间划分为一段段等长的时分复用帧（即 TDM 帧）。时分复用的所有用户是在不同的时间占用同样的频带宽度。这两种复用方法的优点是技术比较成熟，但缺点是不够灵活。时分复用更有利于数字信号的传输。
用 STDM (Statistic TDM)是一种改进的时分复用，它能明显地提高信道的利用率。集中器（concentr or) 常使用这种统计时分复用。
<img src="img\屏幕截图 2022-12-06 145000.png">

### 波分复用
波分复用 WDM (Wavelength Division Multiplexing)就是光的频分复用
现在已能做到在一根光纤上复用几十路或更多路数的光载波信号。千是就使用了密集波分复用 DWDM (Dense Wavelength Division Multiplexing)
<img src="img\屏幕截图 2022-12-06 145533.png">

### 码的复用
码的复用CDM( Code Division Multiplexing) 是另一种吧共享信道的方法。

## 宽带接入技术
### ADSL 技术
非对称数字用户线 ADSL (Asymmetric Digital Subscriber ne)技术是用数字技术对现有模拟电话的用户线进行改造，使它能够承载宽带数字业务。
基于 ADSL 的接入网由以下三大部分组成：数字用户线接入复用DSLAM (DSL Access Multiplexer) 、用户线和用户家中的一些设施。数字用户线接入复用器包括许多 ADSL 调制解调器。 ADSL 调制解调器又称为接入端接单元 ATU (Access Termination Unit)。由于 ADSL 调制解调器必须成对使用，因此把在电话端局（或远端站）和用户家中所用的 ADSL 调制解调器分别记为 ATU-C 和 ATU-R 。
### 光纤同轴混合网 (HFC 网）
它采用模拟技术的频分复用对电视节目进行单向广播传输。但以后有线屯视网进行了改造，变成了现在的光纤同轴混合网 (HFC 网）。
要使现有的模拟电视机能够接收数字电视信号，需要把一个叫作机顶盒(set-t box)设备连接在同轴电缆和用户的电视机之间。但为了使用户能够利用 HFC 网接入到互联网，以及在上行信道中传送交互数字电视所需的一些信息，我们还需要增加一个为 HFC 网使用的调制解调器，它又称为电缆调制解调器（cable modem) 。电缆调制解调器可以做成一个单
独的设备（类似于 ADSL 的调制解调器），也可以做成内置式的，安装在电视机的机顶盒里面。用户只要把自己的计算机连接到电缆调制解调器，就可方便地上网了
### FTTx 技术
光纤到路边 FTTC (C 表示Curb) 、光纤到小区 FTTZ (Z 表示 Zone) 、光纤到大楼 FTTB CB 表示 Bu ld g)、光纤到楼FTTF (F 表示 Floor) 、光纤到办公室 FTTO (O 表示 ffi ce) 、光纤到桌面 FTTD (DDesk)

# 数据链路层
数据链路层屈于计算机网络的低层。数据链路层使用的信道主要有以下两种类型：
(l) 点对点信道。这种信道使用一对一的点对点通信方式。
(2) 广播信道。这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。
##  数据链路层的几个共同问题
### 数据链路和帧
数据链路(data  link) 则是另一个概念。这是因为当需要在一条线路上传送数据时，除了必须有一条物理线路外，还必须有一些必要的通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。现在最常用的是**网络适配器**来实现这些协议。

数据链路层把网络层交下来的数据构成帧发送到链路上，以及把接收到的帧中的数据取出并上交给网络层。在互联网中，网络层协议数据单元就是 IP 数据报（或简称为数据报、分组或包）。

### 三个基本问题
封装成帧，透明传输和差错检测。
1. **封装成帧**
封装成帧(framing)就是在一段数据的前后分别添加首部和尾部，这样就构成了一个帧。
的数据部分长度上限-最大传送单元 MTU (Maximum Transfer Unit)
2. **透明传输**
由千帧的开始和结束的标记使用专门指明的控制字符，因此，所传输的数据中的任何特的组合一定不允许和用作帧定界的控制字符的比特编码—样，否则就会出现帧定界的错误。
<img src="img\屏幕截图 2022-12-06 170727.png">

3. **差错检测**
为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检测措施。目前在数据链路层广泛使用了循环冗余检验 CRC (Cyclic Redundancy Check) 的检错技术。
帧检验序列FCS (Frame Check Se uence)
最后再强调一下，在数据链路层若仅仅使用循环冗余检验 CRC 差错检测技术，则只能做到对帧的无差错接受。不能解决帧重复，帧丢失，帧失序

对于通信质量良好的有线传输链路，数据链路层协议不使用确认和重传机制，即不要求数据链路层向上提供可靠传输的服务。如果在数据链路层传输数据时出现了差错并且需要进行改正，那么改正差错的任务就由上层协议（例如，运输层的 TCP 协议）来完成。
对于通信质量较差的无线传输链路，数据链路层协议使用确认和重传机制，数据链路层向上提供可靠传输的服务
## 点对点协议 PPP
点对点协议 PPP (Point-to-Po int Pro ocol) 则是目前使用得最广泛的数据链路层协议。
### PPP 协议的特点
我们知道，互联网用户通常都要迕桵到某个 ISP 才能接入到互联网。 PPP 协议就是用户计算机和 ISP 进行通伈信所使用的数据链路层协议
<img src="img\屏幕截图 2022-12-06 171800.png">

1. **PPP 协议应满足的需求**
(1) *简单* IETF 在设计互联网体系结构时把其中最复杂的部分放在 TCP 协议中，而网际协议 IP 则相对比较简单，它提供的是不可靠的数据报服务。在这种情况下，数据链路层没有必要提供比 IP 协议更多的功能。
(2) *封装成帧* PPP 协议必须规定特殊的字符作为帧定界符（即标志一个帧的开始和结束的字符），以便使接收端从收到的比特流中能准确地找出帧的开始和结束位置。
(3) *透明性* PPP 协议必须保证数据传输的透明性。
(4) *多种网络层协议* PPP 协议必须能够在同一条物理链路上同时支持多种网络层协议（如 IP和IPX 等）的运行。当点对点链路所连接的是局域网或路由器时， PPP 协议必须同时支持在链路所连接的局域网或路由器上运行的各种网络层协议。
(5) *多种类型链路* 除了要支持多种网络层的协议外， PPP 还必须能够在多种类型的链路上运行。例如，串行的（一次只发送一个比特）或并行的（一次并行地发送多个比特），同步的或异步的，低速的或高速的，电的或光的，交换的（动态的）或非交换的（静态的）点对点链路。
(6) *差错检测*（ error detection) PPP 协议必须能够对接收端收到的帧进行检测，并立即丢弃有差错的帧.
(7) *检测连接状态* PPP 协议必须具有一种机制能够及时（不超过几分钟）自动检测出链路是否处于正常工作状态。
(8) *最大传送单元* PPP 协议必须对每一种类型的点对点链路设置最大传送单元MTU 的标准默认值。
(9) *网络层地址协商* PPP 协议必须提供一种机制使通信的两个网络层（例如，两个IP 层）的实体能够通过协商知道或能够配置彼此的网络层地址。
(10) *数据压缩协商* PPP 协议必须提供一种方法来协商使用数据压缩算法。
### PPP 协议的帧格式
1. **个字段的意义**
F(flag)7E 的二进制表示是 OllllllO)代表帧的开始和结束。A，C暂未定义。
尾部中的第一个字段 (2 字节）是使用 CRC 的帧检验序列 FCS

<img src="img\屏幕截图 2022-12-07 112027.png">

2. **字节填充**
当信息字段中出现和标志字段」样的比特(Ox7E) 组合时，就必须采取一些措施使这种形式上和标志字段一样的比特组合不出现在信息字段中。
3. **零比特填充**
PPP 协议用在 SONET/SDH 链路时，使用同步传输（一连串的比特连续传送）而不是异步传输（逐个字符地传送）。在这种情况下， PPP 协议采用零比特埴充方法来实现透明传输。
### PPP 协议的工作状态
链路控制协议 LCP
<img src="img\屏幕截图 2022-12-07 114307.png">

在双方建立了物理层连接后，PPP 就进入“链路建立“状态，其目的是建立链路层的 LCP 连接。这时 LCP 开始协商一些配置选项，即发送 LCP 的配置请求帧(Configure-Request)。这是PPP 帧，其协议字段置为 LCP 对应的代码，而信息字段包含特定的配置请求。链路的另一端可以发送以下几种响应中的一种：
(I) 配置确认帧（Configure-Ack): 所有选项都接受。
(2) 配置否认帧（Configure-Nak): 所有选项都理解但不能接受。
(3) 配置拒绝帧（Configure-Re ec t):选项有的无法识别或不能接受，需要协商。
LCP 配置选项包括链路上的最大帧长、所使用的鉴别协议(Authenti cate Protocol) 的规约（如果有的话），以及不使用 PPP 帧中的地址和控制字段。

协商结束后双方就建立了 LCP 链路，接若就进入＂鉴别 ”(Authenti cate) 状态。在这一状态，只允许传送 LCP 协议的分组、鉴别协议的分组以及监测链路质报的分组。若使用口令鉴别协议 PAP (Password Authentication Protocol), 则需要发起通信的一方发送身份标识符
和口令。若鉴别身份失败，则转到“链路终止 ”(L nk Term na e) 状态。若鉴别成功，则进入“网络层协议 ”(Network-Layer Protocol)状态。在“网络层协议”状态， PPP 链路两端的网络控制协议 NCP 根据网络层的不同协议互相交换网络层特定的网络控制分组。这个步骤是很重要的，因为现在的路由器都能够同时支持多种网络层协议。总之， PPP 协议两端的网络层可以运行不同的网络层协议，但仍然可使用同一个 PPP 协议进行通信。
## 使用广播信道的数据链路层

### 局域网的数据链路层
局域网最上要的特点是：网络为一个单位所拥有，且地理范围和站点数目均有限。
局域网具有如下的一些优点：
(I) 具有广插功能，从一个站点可很方便地访问全网。局域网上的主机可共享连接在局域网上的各种硬件和软件资源。
(2) 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。
(3) 提高了系统的可靠性(reliability)、可用性(availability)和生存性(survivability)。
局域网可按网络拓扑进行分类。
<img src="img\屏幕截图 2022-12-07 143720.png">

如何共享通信媒体资源
1. **静态划分信道**，已经介绍过的频分复用、时分复用、波分复用和码分复用等。用户只要分配到了信道就不会和其他用户发生冲突。但这种划分信道的方法代价较高，不适合局域网使用。
2. **动态媒体接入控制**，它又称为多点接入(multip le access), 其特点是信道并非在用户通信时固定分配给用户。这里又分为以下两类：
• *随机接入* 随机接入的特点是所有的用户可随机地发送信息。
• *受控接入* 受控接入的特点是用户不能随机地发送信息而必须服从一定的控制。这类的典型代表有分散控制的令牌环局域网和块中控制的多点线路探询(polling),或称为轮询。

**适配器作用**
计算机与外界局域网的连接是通过适配器(adapter) 。适配器本来是在主机箱内插入的一块网络接口板（或者是在笔记本电脑中插入一块 PCMClA 卡一个人计算机存储器卡接口适配器）。这种接口板又称为网络接口卡 NlC (N work Interface Card)或简称为“网卡”。适配器的一个主要功能就是要进行数据串行传输和并行传输的转换。网络上的数据率和计算机总线上的数据率并不相同，因此在适配器中必须装有对数据进行缓存的存储芯片。在主板上插入适配器时，还必须把管理该适配器的设备驱动程序安装在计算机的操作系统中。这个驱动程序以后就会告诉适配器，应当从存储器的什么位置上把多长的数据块发送到局域网，或者应当
在存储器的什么位置上把局域网传送过来的数据块存储下来。适配器还要能够实现以太网协议。
适配器在接收和发送各种帧时，不使用计算机的 CPU。这时计算机中的 CPU 可以处理其他任务。当适配器收到有差错的帧时，就把这个帧直接丢弃而不必通知计算机。当适配器收到正确的帧时，它就使用中断来通知该计算机，并交付协议栈中的网络层。当计算机要发IP 数据报时，就由协议栈把 IP 数据报向下交给适配器，组装成帧后发送到局域网。
<img src="img\屏幕截图 2022-12-07 145844.png">

### CSMA/CD 协议（总线型）

为了通信的简便，以太网采取了以下两种措施：
**第一**采用较为灵活的无连接的工作方式，即不必先建立连接就可以直接发送数据。适配器对发送的数据帧不进行编号，也不要求对方发回确认。当目的站收到有差错的数据帧时（例如，用 CRC 查出有差错），就把帧丢弃，其他什么也不做。对有差错帧是否需要重传则由高层来决定。

**第二**，以太网发送的数据都使用曼彻斯特(Manchester) 编码的信号。进制基带数字信号通常就是高、低电压交替出现的信号。使用这种信号的最大问题就是当出现一长串连续的1或连续的0时，接收端就无法从收到的比特流中提取位同步（即比特同步）信号。
**CSMA/CD, 意思是载波监听多点接入／碰撞检测（Carrier Sense Multiple Access whit Collision)**
下面介绍 CSMNCD 协议的要点。
**“多点接入”**就是说明这是总线型网络，许多计算机以多点接入的方式连接在一根总线上。协议的实质是“载波监听”和＂碰撞检测”。
**“载波监听”**也就是“边发送边监听”。，载波监听就是不管在
想要发送数据之前，还是在发送数据之中，每个站都必须不停地检测信道。在发送前检测信道，是为了避免冲突。
**“碰撞检测”**是适配器边发送数据边检测信道上的信号电压的变化悄况。当两个或几个站同时在总线上发送数据时，总线上的信号电压变化幅度将会增大（互相叠加）。当适配器检测到的信号电压变化幅度超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。

根据以上所讨论的，可以把 CSM CD 协议的要点归纳如下：
1. **准备发送**：适配器从网络层获得一个分组，加上以太网的首部和尾部,组成以太网帧，放入适配器的缓存中。但在发送之前，必须先检测信道。
2. 检测信道：若检测到信道忙，则继续不停地检测，一直等待信道转为空闲。此时若96 比特时间内信道保持空闲（保证了帧间最小间隔），就发送这个帧。
3. 在发送过程中仍不停地检测信道，即网络适配器要边发送边监听。这里只有两种可能性：
＠发送成功：如果在争用期内一直未检测到碰撞，就认为发送成功然后回到(1)
＠发送失败：在争用期内检测到碰撞。这时立即停止发送数据，并按规定发送人为干扰信号。适配器接着就执行指数退避算法，等待 512 比特时间后，返回到步骤（2),续检测信道。但若重传达 16 次仍不能成功，则停止重传而向上报错。以太网每发送完一帧，一定要把已发送的帧暂时保留一下。
### 使用集线器的星形拓扑
这种以太网采用星形拓扑，在星形的中心则增加了一种可靠性非常高的设备，叫作集线器(hub)。双绞线以太网总是和集线器配合使用的。每个站需要用两对无屏蔽双绞线（放在一根电缆内），分别用于发送和接收。由于集线器使用了大规模集成电路芯片，因此媒线器的可靠性就大大提高了。
集线器的一些特点如下：
1. 从表面上看，使用集线器的局域网在物理上是一个星形网，但由于集线器使用电子器件来模拟实际电缆线的工作，因此整个系统仍像一个传统以太网那样运行。也就是说，使用集线器的以太网在逻辑上仍是一个总线网，各站共享逻辑上的总线，使用的还是CSMA/CD 协议（更具体些说，是各站中的适配器执行 CSMNCD 协议）。网络中的各站必须竞争对传输媒体的控制，并且在同一时刻至多只允许一个站发送数据。
2. 一个集线器有许多端口,。因此，一个集线器很像一个多端口的转发器。
3. 集线器工作在物理层，它的每个端口仅仅简单地转发比特，不进行碰撞检测。若两个端口同时有信号输入（即发生碰撞），那么所有的
端口都将收不到正确的帧。
4. 集线器采用了专门的芯片，进行自适应串音回波抵消。这样就可使端口转发出去的较强信号不致对该端口接收到的较弱信号产生干扰（这种干扰即近端串音）。每个比特在转发之前还要进行再生整形并重新定时。

### 以太网的 

1. **MAC 层的硬件地址**
在局域网中，硬件地址又称为物理地址或 MAC 地址（因为这种地址用
MAC 帧中）
在所有计算机系统的设计中，标识系统(identification system)都是一个核心问题。
标准为局域网规定了一种 48 位的全球地址（一般都简称为“地址＂），这就是局域网上的每一台计算机中固化在适配器的 ROM 中的地址。
MAC 地址也叫作硬件地址（hardware address)或物理地址，可见 “MAC 地址“实际上就是适配器地址或适配器标识符 。
播）。需要指出，有的书把上述砐低有效位写为“第一位”，但“第一”的定


我们知道适配器有过滤功能。当适配器从网络上每收到一个 MAC 帧就先用硬件检查MAC 帧中的目的地址。如果是发往本站的帧则收下，然后再进行其他的处理。否则就将此帧丢弃，不再进行其他的处理。这里“发往本
站的帧“包括以下三种帧：
(1) 单播(un cast)帧（一对一），即收到的帧的 MAC 地址与本站的 MAC 地址相同。
(2) 广播（broadcast)帧（一对全体），即发送给本局域网上所有站点的帧（全 地址）。
(3) 多播（mul ti cast)帧（—对多），即发送给本局域网上一部分站点的帧。
以太网适配器还可设置为一种特殊的工作方式，即混杂方式(promscuous mode) 。工作
在混杂方式的适配器只要“听到“有帧在以太网上传输就都悄悄地接收下来，而不管这些帧
发往哪个站。请注意，这样做实际上是＂窃听“其他站点的通信而并不中断其他站点的通信。
2. **MAC 帧的格式**
常用的以太网 MAC 帧格式有两种标准，一种是 DIX Ethernet V2 标准（即以太网 V2标准准），另一种是 IEEE 802.3 标准。
<img src="img\屏幕截图 2022-12-07 162154.png">


以太网 V2 MAC 帧较为简单，由五个字段组成。前两个字段分别为 字节长的目的地址和源地址字段。第三个字段是 字节的类型字段，用来标志上一层使用的是什么协议，以便把收到的 MAC 帧的数据上交给上一层的这个协议。例如，当类型字段的值是 Ox0800
时，就表示上层使用的是 IP 数据报。第四个字段是数据字段，其长度在 46-1500 字节之(46 字节是这样得出的：最小长度 64 字节减去 18 字节的首部和尾部就得出数据字段的最小长度）。最后一个字段是 字节的帧检验序列 FCS （使用 CRC 检验）。
这里我们要指出，在以太网 V2 MAC 帧格式中，其首部并没有一个帧长度（或数据长度）字段。那么， MAC 子层又怎样知道从接收到的以太网帧中取出多少字节的数据交付上一层协议呢？我们在前面讲述图 3-16 的曼彻斯特编码时已经讲过，这种曼彻斯特编码的一个重要特点就是：在曼彻斯特编码的每一个码元（不管码元是 0) 的正中间一定有一
次电压的转换（从高到低或从低到高）。当发送方把一个以太网帧发送完毕后，就不再发送其他码元了（既不发送 ，也不发送 0) 。因此，发送方网络适配器的接口上的电压也就不再变化了。这样，接收方就可以很容易地找到以太网帧的结束位置。在这个位置往前数4字节
FCS 字段长度是4字节），就能确定数据字段的结束位置。
为了接收端迅速实现位同步，从 MAC 子层向下传到物理层时还要在帧的前面插入8个字节（由硬件生成），它由两个字段构成。第一个字段是7个字节的前同步码 (I 交替码），它的作用是使接收端的适配器在接收 MAC 帧时能够迅速调整其时钟频率，使它和发送端的时钟同步，
也就是“实现位同步”（位同步就是比特同步的意思）。第二个字段是帧开始定界符，定义为10101011 。它的前六位的作用和前同步码一样，最后的两个连续的 就是告诉接收端适配器："MAC 帧的信息马上就要来了，请适配器注意接收。 
IEEE 802 .3标准规定凡出现下列情况之一的即为无效的 MAC 帧：
(I) 帧的长度不是整数个字节：
(2) 用收到的帧检验序列 FCS 查出有差错；
(3) 收到的帧的 MAC 客户数据字段的长度不在 46~1500 字节之间。
## 扩展的以太网
### 在物理层扩展以太网
以太网上的主机之间的距离不能太远, 否则主机发送的信号经过铜线的传输就会衰减到使CSMA/CD 协议无法正常工作。在过去广泛使用粗缆或细缆以太网时，常使用工作在物理层的转发器来扩展以太网的地理覆盖范围。那时，两个网段可用一个转发器连接起来。 以太网的主流类型，扩展以太网的覆盖范围已很少使用转发器了。
扩展主机和集线器之间的距离的一种简单方法就是使用光纤（通常是一对光纤）和一对光纤调制解调器.
<ims src="img\屏幕截图 2022-12-07 171452.png">
光纤调制解调器的作用就是进行电信号和光信号的转换。由千光纤带来的时延很小，并且带宽很宽，因此使用这种方法可以很容易地使主机和几公里以外的集线器相连接。如果使用多个集线器，就可以连接成覆盖更大范围的多级星形结构的以太网。
<img src="img\屏幕截图 2022-12-07 171251.png">




### 在数据链路层扩展以太网
扩展以太网更常用的方法是在数据链路层进行的。最初人们使用的是 . 
网桥(bridge) 。网桥对收到的帧根据其 MAC 帧的目的地址进行转发和过滤。
当网桥收到一个帧时，并不是向所有的端口转发此帧，而是根据此帧的目 MAC 地址，查找网桥中的地址表，然后确定将该帧转发到哪一个端口，或者是把它丢弃（即过滤）。
交换式集线器(switch hub), 很快就淘汰了网桥。交换式集线器常称为
以太网交换机(switch)或第二层交换机(L2 switch), 强调这种交换机工作在数据链路层。
1. **以太网交换机的特点**
以太网交换机实质上就是一个多端口的网桥，通常都有十几个或更多的端口，和工作在物理层的转发器、集线器有很大的差别。以太网交换机的每个端口都直接与一个单台主机或另一个以太网交换机相连，并且一般都工作在全双工方式。以太网交换机还具有并行性，即能同时连通多对端口，使多对主机能同时通信（而网桥只能一次分析和转发一个帧）。相
互通信的主机都独占传输媒体，无碰撞地传输数据。换句话说，每一个端口和连接到端口的
主机构成了一个碰撞域，具有N个端口的以太网交换机的碰撞域共有N个。
以太网交换机的端口还有存储器，能在输出端口繁忙时把到来的帧进行缓存。
以太网交换机是—种即插即用设备，其内部的帧交换表（又称为地址表）是通过自学习算法自动地逐渐建立起来的。实际上，这种交换表就是一个内容可寻址存储器 CAM(Content Addressable Memory)。以太网交换机由于使用了专用的交换结构芯片，用硬件转发收到的帧，其转发速率要比使用软件转发的网桥快很多。

2. **以太网交换机的自学习功能**
我们用一个简单例子来说明以太网交换机是怎样进行自学习的。
<img src="img\屏幕截图 2022-12-07 172607.png">



### 虚拟局域网
首先，一个以太网是一个广播域。在以太网上经常会出现大社的广播帧。在交换机的交换表的建立过程中要使用许多广播帧。我们经常使用的 ARP和DHCP 协议，也都要在以太网中传送很多的广播帧。在一个主机数批很大的以太网上传播广播帧，必然会消耗很多的网络资源。如果网络的配置出了些差错，就有可能发生广播帧在网络中无限制地兜圈子，形成了“广播风暴“，使整个的网络瘫痪。
在以太网交换机出现后，可以很方便灵活地建立虚拟局域网 VLAN (Virtual LAN)。这样就把一个较大的局域网，分割成为一些较小的局
域网，而每一个局域网是一个较小的广播域。
虚拟局域网协议允许在以太网的帧格式中插入一个 字节的标识，称为 VLAN 标签（tag),用来指明发送该帧的计算机屈千哪一个虚拟局域网。
<img src="img\屏幕截图 2022-12-07 173646.png">

VLAN 标签的前两个字节总是设置为 Ox8100 （即二进制的 10000001 00000000), 称为 IEEE
VLAN 标签的后两个字节中，前面4位实际上并没有什么作用，后面的 l2 位是该虚拟局域网 VLAN 标识符 YID (YLAN ID), 它唯一地标志了
802.l Q帧屈于哪一个 VLAN 12 位的 YID 可识别 4096 个不同的 VLAN 。插入 VLAN 标签后， 802.I Q帧最后的帧检验序列 FCS 必须重新计算。
<img src="img\屏幕截图 2022-12-07 174115.png">

现在我们有了两个较小的广播域。每台计算机都是通过接入链路(access Link) 连接到以太网交换机的。管理人员划分虚拟局域网的方法有多种。例如，按交换机的端口划分，或按MAC 地址划分。每台主机并不知道自己的 VID 值（但交换机必须知道这些信息）。这些主机通过接入链路发送到交换机的帧都是标准的以太网帧．在一个用多个交换机连接起来的较大的局域网中，可以灵活地划分虚拟局域网，不受地理位值的限制。一个虚拟局域网的范围可以跨越不同的交换机。当然，所使用的交换机必
须要能够识别和处理虚拟局域网。
连接两个交换机端口之间的链路称为汇聚链路(trunk nk)或干线链路。
现在假定A向E发送帧。交换机＃1查到 并没有连接到本交换机，因此必须从汇聚链路把帧转发到交换机＃2, 但在转发之前，要插入 VLAN 标签。不插入 VLAN 标签，交换机#2 就不知道应把帧转发给哪一个 VLAN 。因此在汇聚链路传送的帧是 802.I Q帧。交换机＃2在转发帧之前，要拿走已插入的 VLAN 标签，因此E收到的帧就是A发送的标准以太网帧，而不是 802.l Q帧。
## 高速以太网

### lOOBASE-T 以太网
IOOBASE-T 是在双绞线上传送 100 Mbit/ 基带信号的星形拓扑以太网，仍使用 IEEE802 .3的 CSMA/CD 协议，它又称为快速以太网(Fas hernet)。用户只要使用 100 Mbit/ 的适配器和 100 Mbit/ 的集线器或交换机，就可很方便地由 IOBASE-T 以太网直接升级到 100 Mbit/s, 而不必改变网络的拓扑结构。所有在 IOBASE-T 上的应用软件和网络软件都可保待不变。


### 吉比特以太网
吉比特以太网的标准 IEEE 802.32 有以下几个特点：
(l) 允许在 Gbit/ 下以全双工和半双工两种方式工作。
(2) 使用 IEEE 802.3 协议规定的帧格式。
(3) 在半双工方式下使用 CSMA/CD 协议，而在全双工方式不使用 CSMA/CD 协议。
(4) IOBASE-T 和J OOBASE-T 技术向后兼容。
吉比特以太网可用作现有网络的主干网，也可在高带宽（高速率）的应用场合用来连接计算机和服务器。

### 10 吉比特以太网（lOGbE) 和更快的以太网
10GbE 的帧格式与 IO Mbit/s, I 00 Mbit/s Gbit/s 以太网的帧格式完全相同.
现在以太网的工作范围已经从局域网（校园网、企业网）扩大到城域网和城域网，从而实现了端到端的以太网传输。这种工作方式的好处是：
(1) 以太网是一种经过实践证明的成熟技术，无论是互联网服务提供者 ISP 还足端用户都很愿总使用以太网。
(2) 以太网的互橾作性也很好，不同厂商生产的以太网都能可靠地进行互橾作。
(3) 在广域网中使用以太网时，其价格大约只有同步光纤网 SONET 的五分之－。以太网还能够适应多种传输媒体，如铜缆、双绞线以及各种光缆。
(4) 端到端的以太网连接使帧的格式全都是以太网的格式，而不需格式转
换，这就简化了橾作和管理。

### 使用以太网进行宽带接入
以太网接入的一个重要特点是它可以提供双向的宽带通信，并且可以根据用户对带宽的需求灵活地进彴带宽升级。
当城域网和广域网都采用吉比特以太网或 10 吉比特以太网时，采用以太网接入可以实现端到端的以太网传输，中间不需要再进行帧格式的转换。这就提高了数据的传输效率且降低了传输的成本。
然而以太网的帧格式标准中，在地址字段部分并没有用户名字段，也没有让用户键入密码来鉴别用户身份的过程。
PPPoE (PPP over Ethernet),悠思是“在
以太网 运行 PPP" [RFC 2516] 。现在的光纤宽带接入 FTTx 都要使用 PPPoE 的方式进行接
入。

# 网络层
## 网络层的几个重要概念
网络层要设计得尽量简单，向其上层只提供简单灵活的无连接的、尽最大努力交付的数据报服务。
IP 数据报和 IP 分组是同义词，可以混用。

虚电路服务与数据报服务的对比
|对比的方面| 虚电路服务| 数据报服务|
|-------------|--------------|-------------|--------------|
|思路 |可靠通信由网络保证 | 可靠通信用户主机保证|
| 连接建立 | 必须有| 不需要|
|终点地址| 仅在连接时使用，每个分组使用短的虚拟电路| 每个分组都要有完整的地址|
|分组的转发 | 属于同一条虚拟电路的分组均按照同一路由进行转发|； 每个分组查找转发表进行转发|
| 节点出故障时| 所有通过故障节点的虚拟电路均不能工作 | 出故障的节点可能会丢失分组，一些路由可能会发生变化|

### 网络层的两个层面
第一类是转发源主机和目的主机之间所传送的数据
第二类则是传送路由信息，


<img src="img\屏幕截图 2022-12-07 192958.png">
在传统的互联网中，每一个路由器中，既有转发表义有路由选择软件，因
此既有数据层面也有控制层面。

软件定义网络 SDN (Software Defined Network)
<img src="img\屏幕截图 2022-12-07 192721.png">

但路由器中的路由选择软件都不存在了，因此路由器之间不再相互交换路由信息。在网络的控制层面有一个在逻辑上集中的远程控制器（但在物理上可以巾不同地点的多个服务器组成）。

## 网际协议 IP
与协议 TP 配套仗用的还有三个协议：
• 地址解析协议 ARP (Address Resolution Protocol) 
• 网际控制报文协议 ICMP (Internet Control Message Protocol) 
• 网际组管理协议 IGMP (Internet Group Management Protocol) 
<img src="img\屏幕截图 2022-12-07 193327.png">

### 虚拟互连网络
从一般的概念米讲，将网络互相连接起来要使用一些中间设备。根据中间设备所在的层次，可以有以下四种不同的中间设备：
(I) 物理层使用的中间设备叫作转发器(repeater)
(2) 数踞链路层使川的中间设备叫作网桥或桥接器(bridge), 以及交换机(switch)
(3) 网络层使用的中间设备叫作路由器(router) 了。
(4) 在网络层以上使用的中间设备叫作网关(getway)。


### IP 地址

### IP 地址及其表示方法
1. 分类的 IP 地址
整个的互联网就是一个单一的、抽象的网络。 IP 地址就是给连接到互联网上的每一台中机（或路巾器）的每一个接口，分配一个在全世界范阳内是唯一的 32 位的标识符。 
IP 地址 ::= { ＜网络号＞，＜主机号>}
<img src="img\屏幕截图 2022-12-07 200242.png">

2. **无分类编址 CIDR**
是无分类域间路由选择 CIDR (Classless Inter-Doma in Routing, CIDR 的读音是 “s der")
(1) *网络前缀* 
网络号改称为“网络前缀＂ network-prefix) （或简称为“前缀＂），
用来指明网络，剩下的后面部分仍然是主机号，用来指明主机。
IP 地址 ::= { ＜网络前缀＞，＜主机号>}
CIDR 使用＂斜线记法 ”(slash no ti on), 或称为 CIDR 记法，即在地址后面加上斜线”/”，斜线后面是网络前缀所占的位数。例如， CIDR 表示的一个 IP 地址 128.14.35.7/20,二进制 IP 地址的前 20 位是网络前缀，剩下后面 12 位是主机号。

(3) *地址掩码*
是计算机看不见斜线记法，而是使用二进制来进行各种计算时就必须使用 32 位的地址掩码(address mask) 能够从IP地址迅速算出网络地址。
地址掩码（常简称为掩码）由一连串0和接着的一连串1组成，而1的个数就是网络前缀的长度。地址掩码又称为子网掩码兜在 CIDR 记法中，斜线后面的数字就是地址掩码
的个数。例如， /20 地址块的地址掩码是： 111111 I 1 1111111 I I 11 I 0000 00000000 (20
连续的 和接着的 12 个连续的 0) 。这个掩码用 CIDR 记法表示就是 255.255.240.0/20
把二进制的 IP 地址和地址掩码进行按位 AND 运算，即可得出网络地址
4. **IP 地址的特点**
lP 地址具有以下一些重要特点。
(I) 每一个 IP 地址都由网络前缀和主机号两部分组成。从这个意义上说， IP 地址是一种分等级的地址结构。分两个等级的好处是：第一，IP地址管理机构在分配 IP 地址时只分配网络前缀（第一级），而剩下的主机号（第二级）则由得到该网络前缀的单位自行分配。
第二，路由器根据目的主机所连接的网络前缀（即地址块）来转发分组（而不考虑目的主机号），这样就可以使转发表中的项目数大幅度减少。

(2) 实际上 IP 地址是标志一台主机（或路由器）和一条链路的接口。当一台中机同时迕接到两个网络上时，该主机就必须同时具有两个相应的 IP 地址，其网络前缀必须是不同的。这种主机称为多归属主机(mul ti homed host)。由由于一个路由器至少应当连接到两个网络，因此
一个路由器至少应当有两个不同的 IP 地址。
(4) IP 地址中，所有分配到网络前缀的网络都是平等的。

### IP 地址与 MAC 地址
MAC 地址是数据链路层使用的地址，而 IP 地址是网络层和以上各层使用的地址，是一种逻辑地址。
<img src="img\屏幕截图 2022-12-07 210023.png">

<img src="img\屏幕截图 2022-12-07 210301.png">

(I) IP 层抽象的互联网上只能看到 IP 数据报。
(2) 虽然在 IP 数据报首部有源站 IP 地址，但路由器只根据目的站的 IP 地址进行转发。
(3) 在局域网的链路层，只能看见 MAC 帧。 IP 数据报攸封装竹· MAC 帧中。
(4) 尽管互连在一起的网络的 MAC 地址体系各不相回，但 IP 层抽象的互联网却屏蔽了下层这些很复杂的细节

### 地址解析协议 ARP
<img src="img\屏幕截图 2022-12-07 210953.png">

网络层使用的是 IP 地址，但在实际网络的链路上传送数据帧时，最终还是必须使用链路层的 MAC 地址。 I
解析协议 ARP 解决这个问题的方法是在主机的 ARP 高速缓存中存放一个从 IP 地址到 MAC地址的映射表，并且这个映射表还经常动态更新（新增或超时删除）。
每一台主机都设有一个 ARP 高速缓存(ARP cache), 里面存有本局域网上的各主机和路由器的 IP 地址到 MAC 地址的映射表,映射表存在生存时间，为了处理映射变动。
arp工作
<img src="img\屏幕截图 2022-12-07 211609.png">

ARP 用于解决同一个局域网上的主机或路由器的 IP 地址和 MAC 地址的映射间题。

### IP 数据报的格式
<img src="img\屏幕截图 2022-12-07 212015.png">

1. **IP 数据报首部的固定部分中的各字段**
(I) *版本*  4位（即 1Pv4) 。关于 1Pv6 （即版本 的协议 lP),
(2) *首部长度* 4位，可表示的最大十进制数值是 l5 。首部长度字段所表示数的单位是 32 位字长（ 32 位字长是 字节）。因为 IP 首部的固定部分是 20 字节，因此首部长度字段的最小值是 （即二进制表示的首部长度是 0101) 。 
(3) *区分服务* 8位，用来获得更好的服务。
(4) *总长度* 总长度指首部和数据之和的长度，单位为字节。总长度字段为 16 位，

IP协议下面的每一种数据链路层协议都规定了一个数据帧中的数据字段的
最大长度，这称为最大传送单元 MTU (Maximum Transfer Unit)。

(5) *标识* （identification）16 位。 IP软件在存储器中维持一个计数器，每产生一个
数据报，计数器就加1, 并将此值赋给标识字段。当数据报由于长度超过网络的 MTU 而必须分片时，这个标识字段的值就被复制到所有的数据报片的标识字段中。相同的标识字段的值使分片后的各数报片最后能止确地平装成为原来的数据报。
(6) *标志(flag)* 3位，但目前只有两位有意义。
• 标志字段中的最低位记为 MF (More Fragment)。 MF= 即表示后面”还有分片”的数据报。 MF=O 表示这已是若干数据报片中的最后一个。
• 标忐字段中间的一位记为 DF (Don't Fragment),意思是“不能分片”。只有当 DF = 0时才允许分片。
(7)*片偏移* 13 位。片偏移指出：较长的分组在分片后，某片在原分组中的相对位置.
(8) *生存时间* 8位，生存时间字段常用的英文缩写是 TTL (Time To Live), 表明这是数据报在网络中的寿命。由发出数据报的源点设置这个字段。其目的是防止无法交付的数据报无限制地在互联网中圈子。
(9) *协议* 8位，协议字段指出此数据报携带的数据使用何种协议，以便使目的主机的 IP 层知道应将数据部分上交给哪个协议进行处理。
(10) *首部检验* 16 位。这个字段只检验数据报的首部，但不包括数据
(11) 源地址
(12) 目的地址

## IP层转发分组过程
### 基于终点的转发
先查找目的网络（网络前缀），在找到了目的网络之后，就把分组在这个网络上直按交付目的主机。
### 最长前缀匹配
减少转跳次数，更精准的转跳
主机路由(hos rou e) 又叫作特定主机路由，这是对特定目的主机的 IP 地址专门指明的一个路由。采用特定主机路由可使网络管理人员更方便地控制网络和测试网络，同时也可在需要考虑某种安全问题时采用这种特定主机路由。
还有一种特殊路由是默认路由(defaul rou e) 。这就是不管分组的最终目的网络在哪里，都由指定的路由器 来处理。
### 使用用二叉线索查找转发表

## 网际控制报文协议 ICMP
为了更有效地转发 IP 数据报和提高交付成功的机会，在网际层使用了网际控制报文协ICMP (Internet Control Message Protocol)  ICMP 允许主机或路由器报告差错情况和提供有关异常情况的报告。
<img src="img\屏幕截图 2022-12-08 084127.png">

### ICMP 报文的种类
ICMP 报文有两种，即 ICMP 差错报告报文和 lCMP 询间报文。
ICMP 报文的前 字节是统一的格式，共有三个字段：类型、代码和检
验和。
<img src="img\屏幕截图 2022-12-08 084617.png">

<img src="img\屏幕截图 2022-12-08 084825.png">

下面是不应发送 ICMP 差错报告报文的几种情况：
• ICMP 差错报告报文，不再发送 ICMP 差错报告报文。
• 对第一个分片的数据报片的所有后续数据报片，都不发送 ICMP 差错报告报文。
• 对具有多播地址的数据报，都不发送 ICMP 差错报告报文。
• 对具有特殊地址（如 127.0.0.0 0.0.0.0) 的数据报，不发送 ICMP 差错报告报文。
### ICMP 的应用举例
ICMP 的一个重要应用就是分组网间探测 PING (Packet ln terNe t Gro er), 用来测试两台主机之间的连通性。PING 使用了 ICMP 回送诮求与回送回答报文。 PlNG 是应用层直接使用网络层ICMP 的一个例子。它没有通过运输层的 TCP UDP

### 1Pv6 的基本首部
(1) 更大的地址空间。
(2) 扩展的地址层次结构。 IPv6 由于地址空间很大，因此可以划分为更多的层次。
(3) 灵活的首部格式。 IPv6 数据报的首部和 IPv4 的并不兼容。 IPv6 定义了许多可选的扩展首部，不仅可提供比 1Pv4 史多的功能，而且还可提高路由器的处理效率，这是因为路由器对扩展首部不进行处理（除逐跳扩展首部外）．
(4) 改进的选项。IPv6 允许数据报包含有选项的控制信息，因而可以包含一些新的选项。IPv6 的首部长度是固定的，其选项放在有效载荷中。
(5) 允许协议继续扩充。
(6) 支持即插即用（即自动配置）。因此 IPv6 不衙要使用 DHCP
(7) 支持资源的预分配。 
(8) IPv6 首部改为8字节对齐

<img src="img\屏幕截图 2022-12-08 092859.png">

<img src="img\屏幕截图 2022-12-08 093022.png">

(1) *版本*(version) 4位
(2) *通信量类*(traffic class)8位。这是为了区分不同的 IPv6 数据报的类别或优先级。
(3) *流标号*(flow label) 20 位。 IPv6 的一个新的机制是支待资源预分配，并且允许路由器把每一个数据报与一个给定的资源分配相联系。 IPv6 提出流(flow) 的抽象概念。所谓“流”就是互联网络上从特定源点到特定终点（单播或多播）的一系列数据报（如实时音频或视频传输），而在这个“流”所经过的路径上的路由器都保证指明的服务质量。所有属于同一个流的数据报都具有同样的流标号。
(4) *有效载荷长度*(payload length) 16 位。它指明 IPv6 数据报除基本首部以外的字节数（所有扩展首部都算在有效载荷之内）。
(5) *下一个首部*(next header) 位。它。它相当千 1Pv4 的协议字段或可选字段。
• IPv6 数据报没有扩展首部时，下一个首部字段的作用和 1Pv4 的协议字段一样，它的值指出了基本首部后面的数据应交付 IP 层上面的哪一个高层协议（例如： 6 
• 当出现扩展首部时，下一个首部字段的值就标识后面第一个扩展首部的类型。
(6) *跳数限制(hop limit)* 位。用来防止数据报在网络中无限期地存在。
(7) 源地址 128 位。是数拟报的发送端的 IP 地址。
(8) 目的地址 128 付。是数据报的接收端的 IP 地址。
下六种扩展首部： （1)逐跳选项； (2) 路由选择： (3) 分片： (4) 
鉴别； （5) 封装安全有效载荷： （6) 目的站选项。
### IPv6 的地址
(I) *单播*（unicast) 单播就是传统的点对点通信。 视躲讲梢
(2) *多播*（multicast) 多播是一点对多点的通信，数据报发送到一组计算机中的每一个。
1Pv6 没有采用广播的术语，而是将「播行作多播的一个特例。
(3) *任播*（anycast) 这是 IPv6 增加的一种类型。任播的终点是一组计箕机，但数据报只交付其中的一个，通常是按照路由符法得出的距离最近的一个。
### IPv4 向IPv6 过渡
1. **双协议栈**
双协议栈(dual stack) 是指在完全过渡到 IPv6 之前，使一部分主机（或路由器）同时装IPv4 1Pv6 这两种协议栈。因此双协议栈生机（或路由器）既能够和 IPv6 的系统通信，又能够和 1Pv4 的系统通信。

2. **隧道技术**
IPv6 过渡的另一种方法是隧道技术(tunneling)。
这种方法的要点就是在 IPv6 数据报要进入 1Pv4 网络时，把 IPv6 数据报封装成为 lPv4 数据
<img src="img\屏幕截图 2022-12-08 095741.png">

### ICMPv6 
IPv4 一样， IPv6 也不保证数据报的可靠交付，因为互联网中的路由器可能会丢弃数
据报。因此 IPv6 也需要使用 ICMP 来反馈一些差铅信息。新的版本称为 ICMPv6, 它比ICMPv4 要复杂得多。地址解析协议 ARP 和网际组管理协议 IGMP 的功能都已被合并到 ICMPv6中。

## 互联网的路由选择协议
### 有关路由选择协议的几个基本概念
理想的路由算法
路由选择协议的核心就是路由算法，即需要何种算法来获得路由表中的各项目。一个
理想的路由算法应具有如下的一些特点[BELL86):
(I) *算法必须是正确的和完整的*。这里，“正确＂的含义是：沿若各路由表所指引的路由，分组一定能够最终到达目的网络和目的主机。
(2) *算法在计算上应简单*。路由选择的计算不应使网络通信垃增加太多的额外开销。
(3) *算法应能适应通信量和网络拓扑的变化*，这就是说，要有自适应性。当网络中的通信量发生变化时，算法能自适应地改变路由以均衡各链路的负载。当某个或某些节点、链路发生故障不能工作，或者修理好了再投入运行时，算法也能及时地改变路由。有时称这种自适应性为＂稳健性 ”(robusttness)
(4) *算法应具有稳定性*。在网络通信量和网络拓扑相对稳定的情况下，路由算法应收敛于一个可以接受的解，而不应使得出的路由不停地变化。
(5) *算法应是公平的*。
(6) *算法应是最佳的*。路由选择算法应当能够找出最好的路由，使得分组平均时延最小而网络的吞吐量最大。


2. **分层次的路由选择协议**
互联网采用分层次的路由选择协议
(I) 互联网的规模非常大。
(2) 许多单位不愿意外界了解自己单位网络的布局细节和本部门所采川的路由选择协议，但同时还希望连接到凡联网 I.•
为此，可以把整个互联网划分为许多较小的*自治系统*(autonomous em), 一般都记为AS 。自治系统 AS 是在单一技术管理卜的许多网络、 IP 地址以及路由器，而这些路由器使用一种自治系统内部的路由选择协议和共同的度量。符一个 AS 对其他 AS 表现出的是一个单一的和一致的路由选择策略。这样，互联网就把路由选抒协议划分为两大类。
(I) 内部网关协议 IGP (Interior Gateway Protocol) 即在个自治系统内部使用的路由选择协议，
(2) 外部网关协议 EGP (External Gateway Protocol) 若源主机和 目的的主机处在不同的自治系统中（这曲个自治系统可能仗川个问的内部网关协，那么在不同自治系统 AS间的路由选择，就要使用外部网关协议 EGP 。
自治系统之间的路由选择也叫作域间路由选择（interdomain routing),而在自治系统内部的路由选择叫作域内路由选择(intradomain routing)。
### 内部网关协议 RIP
1. **协议 RIP 的工作原理**
RIP (Routing lnfonnation Pro ocol) 是内部网关协议 IGP 中最先得到广泛使用的协议, 它的中文译名是路由信息协议。 RIP 是一种分布式 的基于距离向量的路由选择协议，是互联网的标准协议，其最大优点就是简单。
RIP 协议要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录（“距离向缢＂）。协议 RIP 将“距离“定义如下：
从一路由器到自接连接的网络的距离定义为 。从一主机到非直接连接的网络的距离定义为所经过的路由器数加 。协议 RlP 的＂距离”'也称为“跳数”。),并且每经过一个网络，跳数就加1，最大为15
协议 RIP 的特点是：
(I) *仅和相邻路由器交换信息*。如果两个路由器之间的通信不需要经过另一个路由器，那么这两个路由器就是相邻的。
(2) *路由器交换的信息是当前本路由器所知道的全部信息*，即自己现在的路由表。也就是说，交换的信息是：“我到本自治系统中所有网络的（最短）距离，以及到每个网络应经过的下一跳路由器”。
(3) *按固定的时间间隔交换路由信息*，
2. **距离向量算法**
对每一个相邻路由器发送过来的 RlP 报文，执行以下步骤：
(I) 对地址为X的相邻路由器发来的 RIP 报文，先修改此报文中的所有项目：把“下一跳”字段中的地址都改为 X, 并把所有的＂距离”字段的值加1。每一个项目都有个三关键数据，即：到目的网络 Net,距离是 d, 下一跳路由器是X。
(2) 对修改后的 RTP 报文中的每一个项目，进行以下步骤：若原来的路由表中没有目的网络 Net,则把该项目添加到路由表中否则（即在路由表中有目的网络 Net,这时就再查看 一跳路由器地址）。若下一跳路由器地址是X，则把收到的项目替换原路由表中的项目否则（即这个项目是：到目的网络 Net,但下一跳路由器不是 X)
若收到的项目中的距离 小于路由表中的距离，则进行更新,否则什么也不。
(3) 分钟还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达的路由器，即把距离置为 16 （距离为 16 表示不可达）。
(4) 返回。
上而给出的距离向量算法的基础就是 Bellman-Ford 算法（或 Ford-Fulkerson 算法）。
3. **坏消息传播得慢**
好消息传播得快，而坏消息传播得慢

###  内部网关协议 OSPF
1. **协议 OSPF 的基本特点**
这个协议的名字是开放最短路径优先 OSPF (Open Shortest Path Frst)。
OSPF 最主要的特征就是使用链路状态协议(link state protocol), 协议 OSPF 的特点是：
(I) 向本自治系统中所有路由器发送信息。这里使用的方法是洪泛法(flooding),这就是路由器通过所有输出端口向所有相邻的路由器发送伯息。而每一个相邻路由器又再将此信息发往具所有的相邻路由器（但不再发送给刚刚发来信息的那个路由器）。
(2) 发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。所谓“链路状态”就是说明本路由器都和哪些路由器相邻“，以及该链路的
＂度量 ”(metric) OSPF 将这个＂度拉“用来表示费用、距离、时延、带宽，等等。
(3) 当链路状态发生变化或每隔一段时间（如 30 分钟），路山器向所有路由器用洪泛法发送链路状态信息。

为了使 OSPF 能够用于规模很大的网络， OSPF 将一个自治系统再划分为若干个更小的范围，叫作区域(area) 。
<img src="img\屏幕截图 2022-12-08 124543.png">

OSPF 还具有下列的一些特点：
(I) OSPF 允许管理员给每条路由指派不同的代价。因此，OSPF 对于不同类型的业务可计算出不同的路由。链路的代价可以是 65535 中的任何一个无位纲的数，因此十分灵活。商用的网络在使用 OSPF 时，通常根据链路带宽来计算链路的代价。这种灵活性是 RIP 所没有的。
(2) 如果到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径。这叫作多路径间的负载均衡(load balanc g)。
(3) 所有在 OSPF 路由器之间交换的分组（例如，链路状态更新分组）都具有鉴别的功能，因而保证了仅在可信赖的路由器之间交换链路状态信息。
(4) OSPF 支持可变长度的子网划分和无分类的编址 CIDR
(5) 由于网络中的链路状态可能经常发生变化，因此 OSPF 让每一个链路状态都带上一32 位的序号，序号越人状态就越新。 
2. **OSPF 的五种分组类型**
OSPF 共有以下五种分组类型：
(I) *问候(Hello)分组*，用来发现和维持邻站的可达性。
(2)  *数据库描述(Databasc Descript)* 分组，向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息。
(3) *链路状态请求(Link State Request)*分组，向对方诮求发送某些链路状态项目的详细信息。
(4) *链路状态更新(Link State Update)* 分组，用洪泛法对全网更新链路状态。
(5) *链路状态确认(Link State Acknowledgment)*分组，对链路史新分组的确认。
### 外部网关协议 BGP
1. **协议 BGP 的主要特点**
第一，互联网的规模太大，使得自治系统 AS 之间路由选择非常困难。
第二，自治系统 AS 之间的路由选择必须考虑有关策略。例如：不能去外网
2. **BGP 路由**
在一个自治系统 AS 中有两种不同功能的路由器，即边界路由器（或边界网关）和内部路由器。
<img src="img\屏幕截图 2022-12-08 141319.png">

当两个边界路由器 进行通信时，必须先建立 TCP 连接，这种 TCP 连接又称为半永久性连接（即双方交换完信息后仍然保持着连接状态）。
BGP 路由＝“前缀,BGP属性”=“前缀，AS-PATH, NEXT-HOP"  
前缀的意思很明确，就是通告的 BGP 路由终点（子网前缀）。
BGP属性有好几种类型但最重要两个就是这里列出的 AS-PATH NEXT-HOP.
BGP 路由每经过一AS, 就将其自治系统号 ASN 加入到 AS-PATH 中 “BGP 路由“必须指出通过哪些自治系统 AS, 但不指出路由中途要通过哪些路由器。
NEXT-HOP （下一跳）是通告的 BGP 路由起点。

3. **三种不同的自治系统 AS**
可以把 AS 划分为中所示的三大类，即末梢 AS (stub AS) 、穿越 AS (transit AS) 和对等AS(peering AS)
<img src="img\屏幕截图 2022-12-08 142951.png">

4. **BGP 的路由选择**
但如果到前缀 有两条或更多的 BGP 路由可供选择，那么就应当根据以下的原则，按照这里给出的先后顺序，选择一条较好的 BGP 路由．
假如从一个 AS 到另外 AS 中的前缀 只有一条 BGP 路由，那么就不存在选择
• 本地偏好 LOCAL-PREF (LOCAL PREFerence)值极高的路由要首先选择。
BGP 路由中的屈件里面有一个选项叫作本地偏好，在属性中记为LOCAL-PREF 。本地偏好也就是本地优先，“本地”的意思是指，从本 AS 开始的、到同一个前缀的不问 BGP路由中，挑选一个较好的（路由。这可由路由器管理员或网络管理员根据政治上或经济上的策略来设置。

• 选择具有 AS 跳数最少的路由。
• 使用热土豆路由选择算法。
看那个端口空闲
• 选择路由器 BGP 标识符的数值最小的路由。
当以上几种力法都无法找出最好的 BGP 路巾时，就可使用 BGP 标识符来选择路由。
5. **BGP 的四种报文**
(I) OPEN （打开）报文，用来与 BGP 连接对等端建立关系。
(2) UPDATE （更新）报文，用来通告某一路由的信息，以及列出要撤销的路由。
(3) KEEPALIVE （保活）报文，用来周期性地证实与对等端的连通性。
(4) NOTIFICATION （通知）报文，用来发送检测到的差错。
OPEN 报文足两个路由器之间建立了 TCP 连接后接浩就必须发送的报文。 OPEN 报文的作用是相互识别对方，协商－些协议参数（如计时器的时间）。收到 OPEN 报文的路由器，就发问 KEEPALIVE 报文表示接受建立 BGP 连接。
### 路由器的构成
1. 路由器结构
路由器是一种具有多个输入端口和多个输出端口的专用计算机，其任务是转发分组。从路由器某个输入端口收到的分组，按照分组要去的目的 
地（即目的网络），把该分组从路由器的某个合适的输出端口转发给下一跳路由器。下一跳路由器也按照这种方法处理分组，直到该分组到达终点为止。路由器的转发分组正是网络层的主要工作。
<img src="img\屏幕截图 2022-12-08 163348.png">

整个的路由器结构可划分为两大部分：**路由选择部分和分组转发部分**。

**路由选择**部分也叫作控制部分，或控制层面，其核心构件是路由选择处理机。路由选择处理机的任务是根据所选定的路由选择协议构造出路由表，同时经常或定期地和相邻路由器交换路由信息而不断地更新和维护路由表。
**分组转发**它由三部分组成：交换结构、
一组输入端口和一组输出端口。小型路由器的端口只
有几个。
交换结构(switch fabric) 又称为交换组织，它的作用就是根据转发表(forward table) 对分组进行处理，将某个输入端口进入的分组从一个合适的输出端目转发出去。
2. **交换结构**
交换结构是路由器的关键构件正是这个交换结构把分组从一个输入端口转
移到某个合适的输出端口。
<img src="img\屏幕截图 2022-12-08 170518.png">

## IP 多播
### IP 多播的基本概念
在互联网上进行多播就叫做 IP 多播。 IP 多播所传送的分组需要使用多播 IP 地址。。在多播数据报的目的地址写入的是多捅组的标识符，然后设法让加入到这个多播组的主机的 IP 地址与多播组的标识符关联起来。
<img src="img\屏幕截图 2022-12-08 170850.png">

多播地址只能用于目的地址，面不能用于源地址。此外，对多播数据报不产生ICMP 差错报文。因此，若在 PTNG 命令后面键入多播地址，将永远不会收到响应。其实多播组的标识符就是 IP 地址中的D类地址。
### 在局域网上进行硬件多播
<img src="img\屏幕截图 2022-12-08 172313.png">

### 网际组管理协议 IGMP 和多播路由选择协议
1. **IP 多播需要两种协议**
<img src="img\屏幕截图 2022-12-08 172738.png">

IGMP 并非在互联网范围内对所有多播组成员进行管理的协议。 IGMP 不知道 IP 多播组包含的成员数，也不知道这些成员都分布在哪些网上。 lGMP 协议是让连接在本地局域网上的多播路由器知道本局域网上是否有
主机参加或退出了某个多播组。

多播转发必须动态地适应多播组成员的变化（这时网络拓扑并未发生变化）
多播路由器在转发多播数据报时，不能仅仅根据多播数据报中的目的地址，而是还要考虑这个多播数据报从什么地方来和要到什么地方去。
多播数据报可以由没有加入多播组的主机发出，也可以通过没有组成员接入的网络
2. **网际组管理协议 IGMP**
第一阶段：当某台主机加入新的多播组时，该主机应向多播组的多播地址发送一个IGMP 报文，声明自己要成为该组的成员。本地的多播路由器收到 IGMP 报文后，还要利用多播路由选择协议把这种组成员关系转发给互联网上的其他多播路由器。
第二阶段：组成员关系是动态的。本地多播路由器要周期性地探询本地局域网上的主机，以便知道这些主机是否还继续是组的成员。只要有一台主机对某个组响应，那么多播路由器就认为这个组是活跃的。
IGMP 设计得很仔细，避免了多播控制信息给网络增加大批的开销。 IGMP 采用的一些
具体措施如下：
(I) 在主机和多播路由器之间的所有通信都使用 IP 多播。只要有可能，携带 IGMP文的数据报都用硬件多播来传送。因此在支持硬件多播的网络上，没有参加 IP 多播的主机不会收到 IGMP 报文。
(2) 多播路由器在探询组成员关系时，只需要对所有的组发送一个请求信息的询问报文。
(3) 当同一个网络上连接有几个多播路由器时，它们能够迅速和有效地选择其中的一个来探询主机的成员关系。因
(4) IGMP 的询问报文中有一个数值 N, 它指明一个最长响应时间
(5) 同一个组内的每一台主机都要监听响应，只要有本组的具他主机先发送了响应，自己就可以不再发送响应了。

3. **多播路由选择协议**
多播路由选择实际上就是要找出以源主机为根节点的多播转发树。
(I) 洪泛与剪除。这种方法适合于较小的多播组，而所有的组成员接入的局域网也是相邻接的。
(2) 隧道技术(tunneling)。隧道技术适用于多播组的位值在地理上很分散的情况。
<img src="img\屏幕截图 2022-12-08 181207.png">

(3) 基于核心的发现技术。这这种方法是对每一个多播组 指定一个核心（core) 路由器，给出它的 IP 单播地址。核心路由器创建出对应于多播组的转发树。
### 虚拟专用网 VPN 和网络地址转换 NAT
在互联网中的所有路由器，对目的地址是专用地址的数据报一
律不进行转发。全面地给出了所有特殊用途的 1Pv4 1Pv6 地址，
但三个 IPv4 专用地址块的指派并无变化，即
(I) 10.0.0.0/8, 即从 10.0.0.0 0.255.255.255
(2) 172.16.0.0/1 2, 即从 172.16.0.0 172.31.255.255
(3) 192.168.0.0/1 6, 即从 192.168.0.0 192 .1 68.255.255

采用这样的专用 IP 地址的互连网络称为专用互联网或本地互联网，或更简单些，就叫作专用网。

<img src="img\屏幕截图 2022-12-08 182217.png">

### 网络地址转换

网络地址转换 NAT (Network Address Translation)这种方法要在专用网连接到互联网的路由器上安装 NAT 软件。装有 NAT 软件的路由器叫作 NAT路由器，它至少有一个有效的外部全球 IP 地址。这样，所有使用本地地址的主机在和外界通信时，都要在 NAT 路由器上将其本地地址转换成全球 IP 地址，才能和互联网连接。
<img src="img\屏幕截图 2022-12-08 185613.png">

设想如果有专用网上外面的主机要发起通信，当 IP 数据报到达 NAT 路由器时， NAT 路由器就不知道应当把目的 TP地址转换成专用网内的哪一个本地 IP 地址。这就表明，专用网内部的主机不能直接充当服务器用。

使用端口号的 NAT 也叫作网络地址与端口号转换 NAPT (Network Address and Port Translation), 而不使用端口号的 NAT 就叫作传统的 NAT (trad onal NAT) 。

NAPT 地址转换表举例
|方向 |字段| 原先的 IP 地址和端口号| 转换后的 IP 地址和端口号|
|---------|---------|----------|-----------|
|从专用网发往互联网| IP 地址：TCP 源端口|192.168 0.3:30000 |172.38.1.5:40001 
|从专用网发往互联网 |IP 地址．TCP 源端口| 192.168.0.4:30000 |172.38 l. 5·40002 
|从互联网发往专用网 |目的 IP 地址TCP 日的端口 |172.38.1.5:40001 |192 168.0 3:30000 
|从互联网发往专用网| 目的 IP 地址TCP 目的的端口 |172.38.1.5:40002| I92.168.0.4:30000

## 多协议标签交换 MPLS
MPLS 利用面向连接技术，使每个分组携带一个叫作标签(label)的小整数。当分组到达交换机（即标签交换路由器）时，交换机读取分组的标签，并用标签来检索分组转发表。
人们经常把 MPLS 与异步传递方式 ATM (Asynchronous Transfer Mode)联系起来，MPLS 并没有取代 IP,
而是作为一种 IP 增强技术，被广泛地应用在互联网中。
MPLS 具有以下三个方面的特点： (l) 支待面向连接的服务质械。 (2) 支持流量工程，均衡网络负载。（3) 有效地支持虚拟专用网 VPN

## MPLS 的工作原理
1. **基本过程**
在传统的 IP 网络中，分组每到达一个路由器，都必须查找转发表，并
按照“最长前缀匹配＂的原则找到下一跳的 IP 地址。当网络很大时，查找含有大量项目的转发表要花费很多的时间。
MPLS 的一个重要特点就是在 MPLS 域的入口处，给每一个 IP 数据报打上固定长度”标签“，然后对打上标签的 IP 数据报用硬件进行转发，
表示在转发时不再上升到第三层查找转发表，而是根据标签在第二层（链路层）用硬件进行转发。 MPLS 可使用多种链路层协议，如 PPP 、以太网、 ATM 以及帧中继等。
MPLS (MPLS doma n) 是指该域中有许多彼此相邻的路由器，并且所有的路由器都是支持 MPLS 技术的标签交换路由器 LSR (Label Switching Router) LSR 同时具有标签交换和路由选择这两种功能，标签交换功能是为了快速转发，但在这之前 LSR 需要使用路由选择功能构造转发表
<img src="img\屏幕截图 2022-12-08 192850.png">

(I) MPLS 域中的各 LSR 使用专门的标签分配协议 LDP (Label Distribution Protocol) 交换报文，并找出和特定标签相对应的路径，即标签交换路径 LSP (Label Switched Path) 。
(2) 当一个 IP 数据报进入到 MPLS 域时， MPLS 入口节点(ingress node)就给它打上标签，井按照转发表把它转发给下一个LSR。以后的所打 LSR 都按照标签进行转发。
IP 数据报打标签的过程叫作分类(classificaon) 。严格的第三层（网络层）分类只使用IP 首部中的字段，如源 IP 地址和 IP 地址等。大多数运营商实现了第四层（运输层）分类（除了要检杏 IP 首部外，运输层还要检查 TCP或UDP 首部中的协议端口号），而有些运背商则实现了第五层（应用层）分类（更进一步地检查数据报的内部并若虑其有效载荷）。
(3) 由于在全网内统一分配全局标签数值是非常困难的，因此此一个标签仅仅在两个标签交换路由器 LSR 之间才有意义。分组每经过一个 LSR, LSR 就要做两件事：一处转发，二．是更换新的标签，即把入标签更换成为出标签。这就叫作标签对换（label swapping)
(4) IP 数据报离开 MPLS 域时， MPLS 出口节点(egress node)就把 MPLS 的标签去除，IP 数据报交付非 MPLS 的主机或路由器，以后就按照普通的转发方法进行转发。


2. **转发等价类 FEC**
MPLS 有个很正要的概念就是转发等价类 FEC (Forward ing Equivalence Class) 。所谓＂转发等价类”就是路由器按照同样方式对待的 IP 数据报的集合。
### MPLS 首部的位置与格式
在把 IP 数据报封装成以太网帧之前，先要插入 MPLS部。从层次的角度看， MPLS 首部就处在第二层和第三层之间.
<img src="img\屏幕截图 2022-12-08 194746.png">

<img src="img\屏幕截图 2022-12-08 194907.png">

MPLS 首部共包括以下四个字段：
(l) 标签值 20 位。由
(2) 试验 3位，目前保留用千试验。
(3) S 1位， (Stack)表示栈，在有“标签栈”时使用。
(4) 生存时间 TTL 8位，用来防止兜圈子
### 新一代的 MPLS
在 SDN 中，数据层面中的交换机是由控制层面进行控制的，这种控制是通过协议 OpenFlow 来实现的。 SDN 不是协议，更不是一种产品。 SDN 是一个体系结构，是一种设计、构建和管理网络的新方法或新概念，其要点就是把网络的控制层面和数据层面分离，而让控制层面利用软件来控制数据层面中的许多设备。可以把协议 OpenFlow 看成是在 SDN体系结构中控制层面和数据层面之间的通信接口，它使得控制层面的控制器可以对数据层面中的物理设备或虚拟设备，进行直接访问和纵。这种控制在逻辑上是集中式的，是基于流的控制。
<img src="img\屏幕截图 2022-12-08 200148.png">

传统意义上的数据层面的任务就是根据转发表来转发分组。。实际上这里有两个步骤。第一个步骤是＂匹配＂，即查找转发表中的网络前缀，进行最长前缀匹配。第二个步骤是“动作“，即把分组从指明的接口转发出去。
SDN 的广义转发中，＂匹配“能够对不同层次（链路层、网络层、运输层）的首部中的字段进行匹配，而“动作”则不仅是转发分组，而且可以把具有同样目的地址的分组从不同的接口转发出去（为了负载均衡）。还可以重写 IP 首部（如同在 NAT 路由器中的地址转换），或者可以人为地阻挡或丢弃一些分组。
在 SDN 中，取代传统转发表的是“流表”(flow able) 。因此，流表就是＂匹配＋动作”的转发表。
强调了一个重要概念： OpenFlow 交换机中的流表是由远程控制器来管理的，而远程控制器通过一个安全信道，使用 OpenFlow 协议来管理 n交换机中的流表。
另一方面， OpenFlow 又是网络交换功能的逻辑结构的规约。我们
还应注意到，尽管网络设备可以由不同厂商来生产，同时也可以使用在不同类型的网络中，但从 SDN 远程控制器器到的，则是统一的逻辑交换功能。
<img src="img\屏幕截图 2022-12-08 201329.png">

其实从 OpenFlow 交换机的角度来看，一个流就是穿过网络的一种分组序列，而在此序列中的分组都共享分组首部某些字段的值。
<img src="img\屏幕截图 2022-12-08 202323.png">

*首部字段值*：这是一组字段，用来使入分组(incom packet)的对应首部与之相匹配，因此又称为匹配字段。匹配不上的分组就被丢弃，或发送到远程控制器做更多的处理。所示的匹配字段有 11 个项目涉及三个层次的首部。
*计数器*：这是一组计数器，可包括已经与该表项匹配的分组数量，以及从该表项上次更新到现在经历的时间。
*动作*：这是一组动作，例如，当分组匹配某个流表项时把分组转发到指明的端口，或丢弃该分组，或把分组进行复制后再从多个端口转发出去，或重写分组的首部字段（第二、三和四层的首部字段）。

<img src="img\屏幕截图 2022-12-08 203243.png">

# 运输层
## 运输层协议概述
### 进程之间的通信
运输层向它上面的应用层提供通信服务，它属于面向通信部分的最高层，同时也是用户功能中的最低层。
网络层为主机之间的通信提供服务，而运输层则在网络层的基础上，为应用进程之间的通信提供服务。

运输层向高层用户屏蔽了下面网络核心的细节（如网络拓扑、所采用
的路由选择协议等），它使应用进程看见的就是好像在两个运输层实体之间有一条端到端的逻辑通信信道当运输层采用面向连接的 TCP 协议时，尽管下面的网络是不可靠的（只提供尽最大努力服务），但这种逻辑通信信道就相当于一条全双工的可靠信道。但当运输层采用无连接的
UDP 协议时，这种逻辑通信信道仍然是一条不可靠信道。

### 运输层的两个主要协议
(1) 用户数据报协议 UDP (User Datagram Protocol)
(2) 传输控制协议 TCP (Transmjssion Control Protocol) 
<img src="img\屏幕截图 2022-12-08 210036.png">

### 运输层的端口
每一个端口用一个称为端口号(port number) 的正整数来标志。主机的操作系统提供了接口机制，使得进程能够通过这种机制找到所要找的端口。
这种在协议栈层间的抽象的协议端口是软件端口，和路由器或交换机上的硬件端口是完全不同的概念。硬件端口是不同硬件设备进行交互的接口，而软件端口是应用层的各种协议进程与运输实体进行层间交互的地点。

(I) **服务器端使用的端口号** 这里又分为两类，最重要的一类叫作熟知端口号(wellknown port number)或全球通用端口号.
<img src="img\屏幕截图 2022-12-08 210559.png">
另一类叫作登记端口号，数值为 1024~49151 。这类端口号是为没有熟知端口号的应用程序使用的。要使用这类端口号必须存 IANA 按照规定的手续登记，以防止重复。
(2) 客户端使用的端口号 数值为 49152~65535 。由千这类端口号仅在客户进程运行时才动态选择，因此又叫作短暂端口号°。这类端口号就是临时端口号，留给客户进程选择临时使用。当服务器进程收到客户进程的报文时，就知道了客户进程所使用的端口号，因而可以把数据发送给客户进程。通信结束后，刚才已使用过的客户端口号就被系统收回，以便给其他客户进程使用。

## 用户数据报协议 UDP
### UDP 概述
(1) *UDP 是无连接的*，因此减少了开销和发送数据之前的时延。
(2) *UDP 使用尽最大努力交付*，即不保证可靠交付，因此主机不需要维持复杂的连接状态表。
(3) *UDP 是面向报文的*。发送方的 UDP 对应川程序交下来的报文，在添加首部后就向下交付 IP 层。 
<img src="img\屏幕截图 2022-12-08 210928.png">

(4) *UDP 没有拥塞控制*，因此网络出现的拥塞不会使源主机的发送速率降低。
(5) *UDP 支持一对一、一对多、多对一和多对多的交互通信*。
(6) *UDP 的首部开销小*，只有8个字节，比 TCP 20 个字节的首部要短。
**复用示意图**
<img src="img\屏幕截图 2022-12-08 211349.png">

### UDP 的首部格式
<img src="img\屏幕截图 2022-12-08 211758.png">

UDP 用户数据报首部中检验和的计算方法有些特殊。在计箕检验和时，要在 UDP 用户数据报之前增加 12 个字节的伪首部。所谓“伪首部”是因为这种伪首部并不是 UDP 用户数据报真正的首部。只是在计算检验和时，临时添加在 UDP 用户数据报前面，得到一个临时UDP 用户数据报。检验和就是按照这个临时的 UDP 用户数据报来计算的。伪首部既不向下传送也不向上递交，而仅仅是为了计算检验和。

## 传输控制协议 TCP 概述
###  TCP 最主要的特点
(I) TCP 是面向连接的运输层协议。这就是说，应用程序在使川 TCP 协议之前，必须先建立 TCP 连接。在传送数据完毕后，必须释放已经建立的 TCP 连接。
(2) TCP 连接只能有两个端点。
(3) TCP 提供可靠交付的服务。通过过 TCP 连接传送的数据，无差错、不丢失、不重复，井且按序到达。
(4) TCP 提供全双工通信。 
(5) 面向字节流。 TCP 中的“流”(stream)指的是流入到进程或从进程流出的字节序列。“面向字节流”的含义是：虽然应用程J子和 TCP 的交互是一次～个数据块（大小不等），但TCP 把应用程序交下来的数据仅仅看成是一连串的无结构的字节流。
<img src="img\屏幕截图 2022-12-08 214033.png">

### TCP 的连接
TCP 连接的端点叫作套接字(socket)或插口
套接字 socket = (IP 地址:端号）  
每一条 TCP 连接唯一地被通信两端的两个端点（即套接字对 socket pair) 所确定。

## 可靠传输的工作原理
### 停止等待协议

1. **无差错情况**
停止等待协议是最简单的无差错情况。
<img src="img\屏幕截图 2022-12-08 215025.png">

2. **出现差错**
第一， 在发送完一个分组后，必须暂时保留已发送的分组的副本（在发生超时直传时使用）。只有在收到相应的确认后才能消除暂时保衍的分组副本。
第二,分组和确认分组都必须进行编号。。这样才能明确是哪一个发送出去的分组收到了确认，而哪一个分组还没有收到确认。
第二，超时计时器设置的重传时间应当比数据在分组传输的平均往返时间更长一些。

3. **确认丢失和确认迟到**
<img src="img\屏幕截图 2022-12-08 215531.png">

4. **信道利用率**
停止等待协议的优点是简单，但缺点是信追利用率太低.
<img src="img\屏幕截图 2022-12-08 215734.png">

U=Td/Td+RTT+Ta

###  连续 ARQ协议
示发送方维待的发送接口，它的意义是：位于发送窗口内的5个分组都可
连续发送出去，而不需要等待对方的确认。这样，信道利用率就提高了。
<img src="img\屏幕截图 2022-12-08 220054.png">

## TCP 报文段的首部格式
TCP 报文段首部的前 20 个字节是固定的，后面有 4n字节是。因此 TCP 首部的最小长度是 20 字节。
首部固定部分各字段的意义如下：
(1) *源端口和目的端口* 各占2个字节，分
(2) *序号* 4字节。TCP向字节流的。在一个 TCP 连接中传送的字节流中的**每一个字节都按顺序编号**。整个要传送的字节流的起始序号必须在连接建立时设置。首部中的序号字段们则指的是本报文段所发送的数据的第一个字节的序号。
(3) *确认号* 4字节，是期望收到对方下一个报文段的第一个数据字节的序号。
(4) *数据偏移* 4位，它指出 TCP 报文段的数据起始处距离 TCP 报文段的起始处有多远。。这个字段实际上是指出 TCP 报文段的首部长度.
(5) *保留* 6位，保留为今后使用，但目前应设为0
下面打6个控制位，用来说明木报文段的性质它们的，意义见下面的(6)~(11)
(6) *紧急* URG (URGent) URG = 1时，表明紧急指针字段有效。它告诉系统此报文段中有紧急数据，应尽快传送（相当干高优先级的据），而不要按原来的排队顺序传送。
URG 时，发送应用进桯就告诉发送方的 TCP 有紧急数据婓传送。于是发送方TCP 就把紧急数据插入到本报文段数据的最前面，而在紧急数据后面的数据仍是普通数据。这时要与首部中紧急指针(Urgent Pointer)字段配合使用。
(7) *确认 ACK (ACKnowledgment)*  TCP 规定，在连接建立后所有传送的报文段都必须把 ACK 置为
(8) *推送 PSH (PuSH)*当两个应用进程进行交互式的通信时，有时在一端的应用进程希望在键入一个命令后守即就能够收到对方的响应。
(9) *复位 RST (ReSeT)* 表明 TCP 连接中出现严重差错（如主机崩溃或其他原因），必须释放连接，然后再重新建立运输连接。
(10) *同步 SYN (SYNchronization)* 在连接建立时用来同步序号。表明这是一个连接诸求报文段。
(11) *终止 FIN (FINish)* 用来释放一个连接。
(12) *窗口* 2字节。窗口值是[0, 2^16- l] 之间的整数。窗口指的是发送本报文段的一方的接收窗口（而不是自己的发送窗口）。接收方的缓存容量单位字节。
(13) *检验和* 2字节。检验和字段检验的范围包括首部和数据这两部分。和 UDP用户数据报一样，在计算检验和时，要在 TCP 报文段的前面加上 12 字节的伪首部。
(14) *紧急指针* 2字节。它指出本报文段中的紧急数据的字节数（紧急数据结束后就是普通数据）。
(15) *选项* 长度可变，最长可达 40 字节。
## TCP 可靠传输的实现
###  以字节为单位的滑动窗口

<img src="img\屏幕截图 2022-12-09 090322.png">

<img src="img\屏幕截图 2022-12-09 090421.png">

<img src="img\屏幕截图 2022-12-09 091120.png">

第一，缓存空间和序号空间都是有限的，并且都是循环使用的
第二，由于缓存或窗口中实际的字节数可能很大

发送缓存用来暂时存放：
(1)发送应用程序传送给发送方 TCP 准备发送的数据；
(2) TCP 已发送出但尚未收到确认的数据。


接收缓存用来暂时存放：
(1)按序到达的、但尚未被接收应用程序读取的数据；
(2)未按序到达的数据。

### 超时重传时间的选择
TCP 采用了一种自适应算法，它记录一个报文段发出的时间，以及收到相应的确认的时间。这两个时间之差就是报文段的往返时间 RTT TCP 保留了 RTT 的一个加权平均往返时间 RTTs 
新的 RTTs = (1- a) （旧的 RTTs) + a*新的 RTT 样本）

### 选择确认 SACK
描述边界，防止重传，只传输未被确认的
<img src="img\屏幕截图 2022-12-09 093039.png">

## TCP的流量控制
### 利用滑动窗口实现流量控制
流量控制(flowcontrol)就是让发送方的发送速率不要太快，要让接收方来得及接收。
<img src="img\屏幕截图 2022-12-09 093759.png">


TCP 连接的一方收到零窗口通知，启动持续计时器(persisence timer)，就发送一个零窗口探测报文段（仅携带1字节的数据），而对方就在确认这个探测报文段时给出了现在的窗口值。
### TCP 的传输效率
第一种机制是 TCP 维持一个变量，它等于最大报文段长度 MSS 心吓
只要缓存中存放的数据达到 MISS 字节时，就组装成一个 TCP 报文段发送出去。第二种机制是发送方的应用进程指明要求发送报文段，即 TCP 支持的推送（push)橾作。第三种机制是发送方的一个计时器期限到了，这时就把当前已有的缓存数据装入报文段（但长度不能超过
MSS) 发送出去。
## TCP 的拥塞控制
### 拥塞控制的一般原理
若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。这种情况就叫作拥塞（congestion) 。

拥塞控制就是防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不至于过载。拥塞控制所要做的都有一个前提，就是网络能够承受现有的网络负荷。流量控制往往是指点对点通信量的控制。
<img src="img\屏幕截图 2022-12-09 101349.png">

### TCP 的拥塞控制方法
TCP 进行拥塞控制的算法有四种，即慢开始（slow-start)、拥塞避免
(congestion avoidance) 、快重传(fast retransmit)和快恢复(fast recovery)
1. **慢开始和拥塞避免**
作基于窗口的拥塞控制。为此，发送方维持一个叫作拥塞窗
cwnd (congestion winndow) 的状态变量。拥塞饼口的大小取决千网络的拥塞程度，并且是动态变化着的。发送方自己的发送窗口等于拥塞窗口。
只要为在超时时间内收到确认消息就可以认为网络拥塞。
慢开始算法的思路是这样的：当主机在已建立的 TCP 连接上开始发送数由小到大逐渐增大注入到网络中的数据字节，也就是说，由小到大逐渐增大拥塞窗口数值。
为了防止拥塞窗口 cwnd 增长过大引起网络拥塞，还需要设置一个慢开始门限 ss hresh状态变量（可以把门限 ss hresh 的数值设置大些，

<img src="img\屏幕截图 2022-12-09 103627.png">


采用快重传算法可以让发送方尽早知道发生了个别报文段的丢失。
<img src="img\屏幕截图 2022-12-09 103909.png">

<img src="img\屏幕截图 2022-12-09 104137.png">

接收方窗口又称为通知窗口(advertised ndow) 。因此，从接收方对发送方的流护控制的角度考虑，发送方的发送窗口一定不能超过对方给出的接收方窗口值 rwnd

### 主动队列管理AQM
网络层的策略对 TCP 拥塞控制影响最大的就是路由器的分组丢弃策略。在最简单的情况下，路由器的队列通常都按照“先进先出 “FIFO (First In First Out)的规则处理到来的分组。

应当在队列长度达到某个值得警惕的数值时（即当网络拥塞有了某些拥塞征兆时），就主动丢弃到达的分组。这样就提醒了发送方放慢发送的速率，因而有可能使网络拥塞的程度减轻，
## TCP 的运输连接管理
### TCP 的连接建立
三次握手
<img src="img\屏幕截图 2022-12-09 104805.png">

###  TCP 的连接释放
<img src="img\屏幕截图 2022-12-09 110236.png">
TCP 还设有个保活计时器keepalive timer) 。设想有这样的情况：
客户已启动与服务器建立CP 连核。但后来客户端的主机突然出故障。

### TCP 的有限状态机
<img src="img\屏幕截图 2022-12-09 110655.png">

# 应用层
## 域名系统 DNS
### 域名系统概述
域名系统 DNS (Domain Name System) 是互联网使用的命名系统，用来把便于人们使用的机器名字转换为 IP 地扯
互联网的域名系统 DNS 被设计成为一个联机分布式数据库系统，并采用客户服务器方式。 DNS 使大多数名字都在本地进行解析(resolve).

### 互联网的域名结构
采用层次树管理
<img src="img\屏幕截图 2022-12-09 112405.png">

(1) **国家顶级域名nTLD**: 
(2) **通用顶级域名gTLD**: 
最先确定的通用顶级域名有7个，即：
com （公司企业）， net（网络服务机构）， org（非营利性组织），int（国际组织）， edu（美国专用的教育机构），gov （美国的政府部门），mil表示（美国的军事部门）。
以后又陆续增加了 13 个迪用顶级域名：
aero （航空运输企业）， asia（亚太地区），biz（公司和企业）， cat（使用加泰隆人的语言和文化团体）， coop（合作团体），info（各种情况），jobs （人力资源管理者）， mobi（移动产品与服务的用户和提供者）， museum （博物馆）， name （个人），pro （有证书的专业人员），tel (Telnic 股份有限公司），travel （旅游业）。
(3) **基础结构域名(infrastructure domain)**: 这种顶级域名只有一个，即arpa, 用于反向域名解析，因此又称为反向域名。

### 域名服务器
<img src="img\屏幕截图 2022-12-09 143441.png">


分为以下四种不同的类型：
(I)**根域名服务器(root name server)**: 根域名服务器是最高层次的域名服务器，也是最重要的域名服务器。所有的根域名服务器都知道所有的顶级域名服务器的域名和 IP 地址。全世界的根域名服务器只使用 13 个不同 IP 地址的域名，虽然互联网的根域名服务器总共只有 13 个域名，但根域名服务器并非仅由 13机器所组成,在互联网中是由 13 套装置 构成这13 组根域名服务器的[W-ROOT] 。每一套装置在很多地点安装根域名服务器（也可称为镜像根服务器），但都使用同一个域名。
(2) **顶级域名服务器**（即 TLD 服务器）：这些域名服务器负责管理在该顶级域名服务器注册的所有二级域名。当收到 DNS 杳询请求时，就给出相应的回答（可能是最后的结果，也可能是下一步应当找的域名服务器的 IP 地址）。
(3) **权限域名服务器**：当一个权限域名服务器还不能给出最后的查询回答时，就会告诉发出查询请求的 DNS 客户，下一步应当找哪一个权限域名服务器。
(4) **本地域名服务器**(local name server): 当一台主机发出 DNS 查询诮求时，这个查询请求报文就发送给本地域名服务器。

第一，主机向本地域名服务器的查询一般都采用递归查询(recurs ve uery)。
第二，本地域名服务器向根域名服务器的查询常采用迭代查询。
<img src="img\屏幕截图 2022-12-09 144959.png">

在域名服务器中广泛地使用了高速缓存。高速缓存用来存放最查询过的域名以及从何处获得域名映射信息的记录。

## 文件传送协议
### FTP 概述
文件传送协议 FTP (File Transfer Protocol)  
FTP 提供交互式的访问，允许客户指明文件的类型与格式（如指明是否使用 ASCII 码），允许文件具有存取权限。
文件共享协议中的另一大类是联机访问(on-l ne access) 。联机访问意味允许多个程序同时对一个文件进行存取。
### FTP 的基本工作原理
经常遇到的问题是：
(I) 计算机存储数据的格式不同。
(2) 文件的目录结构和文件命名的规定不同。
(3) 对于相同的文件存取功能，橾作系统使用的命令不同。 
(4) 访问控制方法不同。

FTP 使用客户服务器方式。 FTP 服务器进程可同时为多个客户进程提供服务。 FTP的服务器进程由两大部分组成： 主进程，负责接受新的请求；另外有若干个从属进程，负责处理单个诸求。
主进程的工作步骤如下：
(I) 打开熟知端口（端口号为 21), 使客户进程能够连接上。
(2) 等待客户进程发出连接请求。
(3) 启动从属进程处理客户进程发来的请求。从属进程对客户进程的请求处理完毕后即终止，但从属进程在运行期间根据需要还可能创建其他一些子进程。
(4) 回到等待状态，继续接受其他客户进程发来的诸求。主进程与从屈进程的处理是并发进行的。
<img src="img\屏幕截图 2022-12-09 150549.png">

NFS 允许应用进程打开一个远地文件，并能在该文件的某一个特定的位置上开始读写数据。

### 简单文件传送协议 TFTP
TCP/IP 协议族中还有一个简单文件传送协议 TFTP (Trivial File Transfer Protocol), 它是一个很小且易于实现的文件传送协议虽然 TFTP 也使用客户服务器方式，但它使用 UDP 数据报，因此 TFTP 视频
要有自己的差错改正措施。 TFTP 只支持文件传输而不支待交互。 
TFTP 的主要优点有两个。第一， TFTP 可用于 UDP 环境。第二， TFTP 代码所占的内存较小。这对较小的计算机或某些特殊用途的设备是很重要的。
TFTP 的主要特点是：
(I)每次传送的数据报文中有 512 字节的数据，但最后一次可不足 512 字节
(2) 数据报文按序编号，从1开始。
(3) 支持 ASCII 码或二进制传送。
(4) 可对文件进行读或写。
(5) 使用很简单的首部。
## 远程终端协议 TELNET
TELNET 是一个简单的远程终端协议。用户用TELNET 就可在其所在地通过 TCP 连接注册（即登录）到远地的另一台主机上（使用主机名或 IP 地址）。 TELNET 能将用户的击键传到远地主机，同时也能将远地主机的输出通过TCP 连接返回到用户屏幕。这种服务是透明的，因为用户感觉到好像键盘和显示器是直接连在远地主机上的。因此， TELNET 又称为终端仿真协议。

### 万维网 WWW
万维网 WWW (World Wide Web) 是一个大规模的、联机式的信息储藏所，英文简称为Web

万维网是一个分布式的超媒体(hypermedia) 系统．它是超文本(hyp rtext)系统的扩充。所谓超文本是指包含指向其他文档的链接的文本(text)。一个超文本由多个信息源链接成，而这些信息源可以分布在世界各地，并且数目也是不受限制的。利用一个链接可使用户找到远在异地的另一个文档，而这又可链接到其他的文档（依此类推）。这些文档可以位于世界上任何一个接在互联网上的超文本系统中。超文本是万绯网的基础。
### 统一资源定位符 URL
1. **URL 的格式**
统一资源定位符 URL 是用来表示从互联网上得到的资源位置和访问这些资源的方法。
协议://主机名:端口/路径
2. **使用 HTTP URL**
### 超文本传送协议 HTTP
1. **HTTP 的操作过程**
从层次的角度看， HTTP 是面向事务的(transaction-oriented)应用层协议，它是万维网上能够可靠地交换文件（包括文本、声音、图像等各种多媒体文件）的重要基础。
<img src="img\屏幕截图 2022-12-09 153146.png">

协议 HTTP 是无状态的(stateless) 。也就是说，同一个客户第二次访问同一个服务器上的页面时，服务器的响应与第一次被访问时的相同.
<img src="img\屏幕截图 2022-12-09 153524.png">

(1) HTTP/I.I 具有流水线的工作方式。这就是在 TCP 连接建立后客户可以连续向服务器发出许多个请求，而不必等到收到一个响应后再发送下一个请求。但服务器发回响应时必须按先后顺序排队，逐个地发送给客户。有时遇到某个响应迟迟不能发回，那么排在后面的一些响应就必须等待很长的时间。 HTTP/2 把服务器发回的响应变成可以并行
地发回（使用同一个 TCP 连接），这就大大缩短了服务器的响应时间。
(2) 使用 HTTP/ 1. 时，当客户收到服务器发回的响应后，原来建立的 TCP 连接就释放了。如果客户还要继续向该服务器发送新的诸求，就必须重新建立 TCP 连接。 HTTP/2 允许客户复用 TCP 连接进行多个请求，这样就节省了 TCP 连续多次建立和释放连接所花费的时间。
(3) HTTP/ 1.1的请求和响应报文是面向文本的(tex -or en ed) 。当客户连续发送请求并受到响应时，在 TCP 连接上传送的 HTTP 报文首部成为不小的开销。在这些首部中有很多字段是重复的。为此， HTTP/2 把所有的报文都划分为许多较小的二进制编码的帧，并采用了
新的压缩算法，不发送重复的首部字段，大大减小了首部的开销，提高了传输效率。

2. **代理服务器**
代理服务器(prox server) 是一种网络实体，它又称为万维网高速缓存(Web cache) 。代理服务器把砐近的一些请求和响应暂存在本地磁盘中。当新请求到达时，若代理服务器发现这个请求与暂时存放的请求相同，就返回暂存的响应，
### 万维网的信息检索系统
在万维网中用来进行搜索的工具叫作搜索引擎（search engi ne) 。搜索引擎的种类很多，但大体上可划分为两大类，即全文检索搜索引擎和分类目录搜索引擎。
全文检索搜索引擎是一种纯技术型的检索工具。它的工作原理是通过搜索软件（例如一种叫作“蜘蛛”或“网络机器人”的 pider 程序）到互联网上的各网站收集信息，找到一个网站后可以从这个网站再链接到另一个网站，像蜘蛛爬行一样。然后按照一定的规则建立一个很大的在线索引数据库供用户查询。用户在查询时只要输入关键词，就从已经建立的索引数据库里进行查询（并不是实时地在互联网上检索到的信息）

分类目录搜索引擎并不采集网站的任何信息，而是利用各网站向搜索引擎提交网站信息时填写的关键词和网站描述等信息，经过人工审核编辑后，如果认为符合网站登录的条件，则输入到分类目录的数据库中，供网上用户查询。因此，分类目录搜索也叫作分类网站搜索。
<img src="img\屏幕截图 2022-12-09 162623.png">

值得注意的是，目前出现了垂直搜索引擎(vertical search engine), 它针对某一特定领域、特定人群或某一特定需求提供搜索服务。垂直搜索也是提供关键字来进行搜索的.
元搜索引擎(meta search engine), 它把用户提交的检索请求发送到
多个独立的搜索引擎上去搜索，并把检索结果渠中统一·处理，以统一的格式提供给用户，因此是搜索引擎之上的搜索引擎。
2. **Google 搜索技术的特点**
它的核心技术就是 Pa eRank™, 译为网页排名。

## 电子邮件
### 电子邮件概述
简单邮件传送协议 SMTP (Simple Mail Transfer Protocol) 
用互联网邮件扩充 MIME (Multipurpose Internet Mail Extensions)
一个电子邮件系统应具有三个主要组成构件，这就是用户代理、邮件服
务器，以及邮件发送协议（如 SMTP) 和邮件读取协议（如 POP3) POP3 是邮局协议(PosOffice Protocol) 
<img src="img\屏幕截图 2022-12-09 163743.png">

用户代理 UA (User Agent)就是用户与电子邮件系统的接口，在大多数情况下它就是运行在用户计算机中的一个程序。用户代理向用户
提供一个很友好的接口（目前主要是窗口界面）来发送和接收邮件。
用户代理至少应当具有以下4个功能。
(1) *撰写*。给用户提供编辑信件的环境。例如，应让用户能创建便于使用的通信录。回信时不仅能很方便地从来信中提取出对方地址，并自动地将此地址写入到邮件中合适的位置，而且还能方便地对来信提出的问题进行答复
(2) *显示*。能方便地在计算机屏器上显示出来信（包括来信附上的声音和图像）。
(3) *处理*。处理包括发送邮件和接收邮件。例如，阅读后删除、存盘、打印、转发等，以及自建目录对来信进行分类保存。
(4) *通信*。发信人在撰写完邮件后，要利用邮件发送协议将邮件发送到用户所使用的邮件服务器。
邮件服务器需要使用两种不同的协议。一种协议用于用户代理向
邮件服务器发送邮件或在邮件服务器之间发送邮件，如 SMTP 协议，而另一种协议用于用户代理从邮件服务器读取邮件，如邮局协议 POP3。

### 简单邮件传送协议 SMTP
1. **连接建立**
发件人的邮件送到发送方邮件服务器的邮件缓存后， SMTP 客户就每隔一定时间对邮件缓存扫描一次。如发现有邮件，就使用 SMTP 的熟知端口号码 25 与接收方邮件服务器的 SMTP 服务器建立 TCP 连接。在连接建立后，接收方 SMTP 服务器要发出"220 Service ready"（服务就绪）。然后 SMTP 客户向 SMTP 服务器发送 HELO 命令，附上发送方的主机名。 SMTP 服务器若有能力接收邮件，则回答： “250 OK", 表示已准备好接收。若 SMTP 服务器不可用，则回答 “421 Service not ava lable" （服务不可用）。
如在一定时间内（例如三天）发送不了邮件，邮件服务器会把这个情况通知发件人。
 
2. **邮件传送**
邮件的传送从 MAIL 命令开始。 MAIL 命令后面有发件人的地址。如：<x ex en@ hua.or .cn> 。若 SMTP 服务器已准备好接收邮件，则回答 “250 OK”。否则，返回一个代码，指出原因。如： 451 （处理时出错）、 452 （存储空间不够）、 500 （命令无法识别）等。

3. **连接释放**
邮件发送完毕后， SMTP 客户应发送QUIT 命令。 SMTP 服务器返回的信息是 “221（服务关闭）“,表示 SMTP 同意释放 TCP 连接。邮件传送的全部过程即结束。

### 邮件读取协议 POP3和IMAP
POP3 和网际报文存取协议IMAP (Internet Message Aecess Pro oeol) 。
邮局协议 POP 是一个非常简单、但功能有限的邮件读取协议。
POP3 也使用客户服务器的工作力式。在接收邮件的用户计算机中的用户代理必须运行POP3 客户程序，
IMAP POP3 的主要功能比较
|操作位置| 操作内容| IMAP| POP3| 
|收件箱| 阅读、标记、移动、删除邮件等 |客户端与邮箱更新同步| 仅在客户端内|
|发件箱| 保存到已发送 |存户端与邮箱更新同步| 仅在客户端内
|创建文件夹 |新让自定义的文件夹| 客户端与邮箱更新同步 |仅在客户端内
|草稿| 保存草稿| 客户端与邮箱更新同步 |仅在客户墙内
|垃圾文件夹 |接收并移入垃圾文件夹的邮件| 支持| 不支什
|广告邮件 |接受并移入广告邮件夹的邮件| 支持 |不支待

### 基于万维网的电子邮件
### 通用互联网邮件扩充 MIME

1. **MIME 概述**
前面所述的电子邮件协议 SMTP 有以下缺点：
(I) SMTP 不能传送可执行文件或其他的二进制对象。
(2) SMTP 限于传送 位的 ASCII 码。
(3) SMTP 服务器会拒绝超过一定长度的邮件。
(4) 某些 SMTP 的实现并没有完全按照 SMTP 的互联网标准。常见的问题如下：
• 回车、换行的删除和增加；
• 超过 76 个字符时的处理；截断或自动换行；
• 后面多余空格的删除；
• 300 • 
• 将制表符tab 转换为若干个空格。
通用互联网邮件扩充 MIME 
<img src="img\屏幕截图 2022-12-09 170320.png">

MIME 主要包括以下三部分内容：
(I) 5个新的邮件首部字段，它们可包含在原来的邮件首部中。这些字段提供了有关邮件主体的信息。
(2) 定义了许多邮件内容的格式，对多媒体电子邮件的表示方法进行了标准化。
(3) 定义了传送编码，可对任何内容格式进行转换，而不会被邮件系统改变。

下面是 MIME 增加的 个新的邮件首部的名称及其意义（有的可以是选项）。
(I) MIME-Version: 标志 MIME 的版本。现在的版本号是1. 
(2) Content-Description: 这是可读字符串，说明此邮件主体是否是图像、音频或视频。
(3) Content-Id: 邮件的唯一标识符。
(4) Conntent -Transfer-Encoding:在传送时邮件的主体是如何编码的。
(5) Content-Type: 说明邮件主体的数据类型和子类型
## 动态主机配置协议 DHCP(Dynamic Host Configuration Prot ocol)
是动态主机配置协议 , 它提供了一种机制，称为即插即用连网(plug -and-play networking)。这种机制允许一台计算机加入新的网络和获取 IP 地址而不用手工参与。

DHCP 使用客户服务器方式。需要 IP 地址的主机在启动时就向 DHCP 服务器广播发送发现报文(DHCPDISCOVER) （将目的 IP 地址置为全1 ，即 255.255.255.255), 这时该主机就成为 DHCP 客户。发送广播报文是因为现在还不知道 DHCP 服务器在什么地方，因此要(DISCOVER)DHCP 服务器的 IP 地址。这台主机目前还没有自己的 IP 地址，因此它将 IP数据报的源 IP 地址设为全0。这样，在本地网络上的所有主机都能够收到这个广插报文，但只有 DHCP 服务器才对此广播报文进行回答。 DHCP 服务器先在其数据库中查找该计算机的配置信息。若找到，则返回找到的信息。若找不到，则从服务器的 IP 地址池(address
ool) 中取一个地址分配给该计算机。 DHCP 服务器的回答报文叫作提供报文(DHCPOFFER),表示“提供”了 IP 地址等配置信息。
但是我们并不愿意在每一个网络上都设置一个 DHCP 服务器，因为这样会使 DHCP务器的数量太多。因此现在是使每一个网络至少有一个 DHCP 中继代理(relay agent)，它配置了 DHCP 服务器的 IP 地址信息。当 DHCP 中继代理收到主机以广播形式发送的发现报文后，就以单播方式向 DHCP 服务器转发此报文，并等待其回答。收到 DHCP 服务器回答的提供报文后， DHCP 中继代理再把此提供报文发回给主机 。


## 简单网络管理协议 SNMP

### 网络管理的基本概念
虽然网络管理还没有精确定义，但它的内容可归纳为：
网络管理包括对硬件、软件和人力的使用、综合与协调，以便对网络资源进行监视、测试、配置、分析、评价和控制，这样就能以合理的价格满足网络的一些需求，如实时运行性能、服务质量等。网络管理常简称为网管。

管理站又称为管理器，是整个网络管理系统的核心。所有向被管设备发送的命令都是从管理站发出的。管理站的所在部门也常称为网络运行中心 NOC (Network Operations Center) 。
<img src="img\屏幕截图 2022-12-09 172413.png">

在被管网络中有很多的被管设备（包括设备中的软件）。被管设备可以是主机、路由器、打印机、媒线器、网桥或调制解调器等。在每一个被管设备中可能有许多被管对象(Managed Object)。
在每一个被管设备中都要运行一个程序以便和管理站中的管理程序进行通信。这些运行着的程序叫作网络管理代理程序。
圆形图标所示）。
简单网络管理协议 SNMP (Simple Network Management Protocol) 中的管理程序和代理程序按客户服务器方式工作。管理程序运行 SNMP 客户程序，而代理程序运行 SNMP 服务器程序。在被管对象上运行的 SNMP 服务器程序不停地监听来自管理站的 SNMP 客户程序的
请求（或命令）。一旦发现了，就立即返回管理站所需的信息，或执行某个动作。在网络系统中往往是一个（或少数几个）客户程片与很多的服务器程序进行交互。


若网络元素使用的不是 SNMP 协议而是另一种网络管理协议，那么 SNMP 协议就无法控制该网络元素。这时可使用委托代理(proxy agent)。委托代理能提供如协议转换和过滤操作等功能对被管对象进行管理。
SNMP 的网络管理巾三个部分组成，即 SNMP 本身、管理信息结构 SMI (Structure of Management Information)和管理信息库 MIB (Management Information Base) 。
SNMP 定义了管理站和代理之间所交换的分组格式。所交换的分组包含各代理中的对象名及其状态。 SNMP 负责读取和改变这些数值。
SMI 定义了命名对象和定义对象类型（包括范围和长度）的通用规则，以及把对象和对象的值进行编码的规则。
MIB 在被管理的实体中创建了命名对象，并规定了其类型。

### 管理信息结构 SMI
1.  **被管对象的命名**
SMI 规定，所有的被管对象都必须处在对象命名树(object naming t ree)上
<img src="img\屏幕截图 2022-12-09 173650.png">

2. **被管对象的数据类型**
分为简单类型和结构化类型
几种简单类型
<img src="img\屏幕截图 2022-12-09 173932.png">

数据类型 sequence 类似于 语言中的 sruct或 record, 它是一些简单数据类型的组合（不一定要相同的类型）。而数据类型 sequence of类似于 语言中的 array,它是同样类型的简单数据类型的组合，或同样类型的 sequence 数据类型的组合。
3. **编码方法**
SMI 使用 ASN.I 制定的基本编码规则 BER (Basic Encoding Rule)进行数据的编码。 
<img src="img\屏幕截图 2022-12-09 174349.png">

(1)*T（tag）*字段又叫作标记字段，占1字节。 字段比较复杂，因为它要定义的数据类型较多。 字段又再分为以下三个子字段：
• 类别（2 位）共四种：通用类(00), ASN.I 定义的类型；应用类(01), SMI义的类型；上下文类(10), 即上下文所定义的类型；专用类(11), 保留为特定厂商定义的类型。
• 格式 (1 位）共两种，指出数据类型的种类：简单数据类型（0), 结构化数据类型
• 编号 (5 位）用米标志不同的数据类型。编号的范围一般为 0~30。当编号大于 30时， 字段就要扩展为多个字节。 
(2) *L*（length）字段又叫作长度字段（单乍节或多字节）。
(3) *V*（value）字段又叫作值字段，用于定义数据元素的值。

### 管理信息库 MIB
所谓“管理信息”就是指在互联网的网管框架中被管对象的集合。被管对象必须维持可供管理程序读写的若干控制和状态信息。这些被管对象构成了一个虚拟的信息存储器，所以才称为管理信息库 MIB。


## 应用进程跨越网络的通信
<img src="img\屏幕截图 2022-12-09 180442.png">

应用编程接口 API(Application Programming Interface) API 从程序设计的角度定义了许多标准的系统调用函数。应用进程只要使用标准的系统调用函数就可得到操作系统的服务。因此从程序设计的角度看，也可以把 API 看成是应用程序和操作系统之间的接口。
现在 TCP/IP 协议软件已驻留在操作系统中。
UNIX 橾作系统定义的一种 APl ，它又称为套接字接口 (socket interface) 。
微软公司在其操作系统中采用了套接字接口 API ，形成了一个稍有不同的 API ，并称之为 Windows Socket.

从另一种角度看，计算机之间的通信就是本计算机要读取另一个地点的计算机中的数据，或者要把数据从本计算机写入到另一个地点的计算机中
<img src="img\屏幕截图 2022-12-09 200132.png">

当应用进程（客户或服务器）需要使用网络进行通信时，必须首先发出 socket系统调用，请求操作系统为其创建一个“套接字“。这个调用的实际效果是诸求操作系统把网络通信所需要的一些系统资源（存储器间、 CPU 时间、网络带宽等）分配给该应用进程。操作系统为这些资源的总和用一个叫作套接字描述符(socket descriptor) 的号码来表示，然后把这个套接字描述符返回给应用进程。此后，应用进程所进行的网络操作（建立连接、收发数据、调整网络通信参数等）都必须使用这个套接字描述符。所以，几乎所有的网络系统调用都把这个套接字描述符作为套接字的许多参数中的第一个参数。在处理系统调用的时候，通过套接字描述符，操作系统就可以识别出应该使用哪些资源来完成应用进程所请求的服务。通信完毕后，应用进程通过一个关闭套接字的 close 系统调用通知操作系统回收与该套接字描述符相关的所有资源。

<img src="img\屏幕截图 2022-12-09 200721.png">

### 几种常用的系统调用
1. **连接建立阶段**
套接字被创建后，它的端口号和 IP 地址都是空的，因此应用进程要调用 bind（绑定）米指明套接字的本地地址。

服务器在调用bind 后，还必须调用 listen（收听）把在接字设置为被动方式，以便随时接受客户的服务请求。

服务器紧接着就调用 accept（接受），以便把远地客户进程发来的连接请求提取出来。系统调用 accept的一个变量就是要指明足从哪一个套接字发起的连接。
<img src="img\屏幕截图 2022-12-09 201922.png">

2. **数据传送阶段**
客户和服务器都在 TCP 连接上使用 send 系统调用传送数据，使用 recv 系统调用接收数据。
调用 send 需要三个变量：数据要发往的套接字的描述符、要发送的数据的地址以及数据的长度。通常 send 调用把数据复制到操作系统内核的缓存中。若系统的缓存已满， send就暂时阻塞，直到缓存有空间存放新的数据。
调用 recv 也需要三个变昼：要使用的套接字的描述符、缓存的地址以及缓存空间的长度。
3. 连接释放阶段
一旦客户或服务器结束使用套接字，就把套接字撤销。这时就调用close 释放连接和撤销套接字
<img src="img\屏幕截图 2022-12-09 202209.png">

UDP 服务器由于只提供无连接服务，因此不使用 listen 和accept系统调用。
## P2P 应用
P2P 应用的范围很广，例如，文件分发、实时音频或视频会议、数据库系统、网络服务持（如 P2P 打车软件、 P2P 理财等）
### 具有集中目录服务器的 P2P 工作方式
一个数据库管理资源和IP的映射，想要获取资源需要去数据库查ip和资源的映射，选择合适的ip下载。

### 具有全分布式结构的 P2P 文件共享程
了一种有限范围的洪泛查询。

用分散定位和分散传输技术

# 网络安全
## 网络安全问题概述
### 计算机网络面临的女全性威胁
计算机网络的通信而临两大类威胁，即被动攻击和主动攻击

被动攻击是指攻击者从网络上窃听他人的通信内容。通常把这类攻击称为截获。在被动攻击中，攻击者只是观察和分析某一个协议数据单元 PDU （这里使用 PDU 这一名词是考虑到所涉及的可能是不同的层次）而不干扰信息流

主动攻击有如下几种蚊常见的方式。
(I) *篡改* 攻击者故意篡改网络传送的报文。
(2) *恶意程序* 恶意程序(rogue program) 种类繁多，对网络安全威胁较大的主要有以
下几种：
• 计算机病毒（computer virus), 一种会“传染”其他程序的程序，“传染”是通过修改其他程序来把自身或自己的变种复制进去而完成的。
• 计算机蠕虫(computer worm) ，一种通过网络的通信功能将自身从一个节点发送到另一个节点并自动启动运行的程序。
• 特洛伊木马(Trojan horse), 一种程序，它执行的功能并非所声称的功能而是某种恶意功能。如一个编译程序除了执行编译任务以外，还把用户的源程序偷偷地复制下来，那么这种编译程
• 逻辑炸弹（logic bomb), 一种当运行环境满足某种特定条件时执行其他特殊功能的程序。
• 后门入侵（backdoor knocking),是指利用系统实现中的漏洞通过网络入侵系统。。
• 流氓软件，一种未经用户允许就在用户计算机上安装运行并损害用户利益的软件，
(3) 拒绝服务 DoS (Denial of Service) 指攻击者向互联网上的某个服务器不停地发送大量分组，使该服务器无法提供正常服务，甚至完全瘫痪。 
还有其他类似的网络安全问题。例如，在使用以太网交换机的网络中，攻击者向某个以太网交换机发送大量的伪造源 MAC 地址的帧。以太网交换机收到这样的帧，就把这个假的源 MAC 地址写入交换表中（因为交换表中没有这个地址）。由于这种伪造的地址数据太大，因此很快就把交换表填满了，导致以太网交换机无法正常工作（称为交换机中毒）。

### 安全的计算机网络
一个安全的计绊机网络应设法达到以下四个目标：
1. **机密性**
机密性（或私密性）就是只有信息的发送方和接收方才能懂得所发送信息的内容，而信息的截获者则看不懂所截获的信息。显
2. **端点鉴别**
安全的计算机网络必须能够鉴别信息的发送方和接收方的真实身份。
3. **信息的完整性**
即使能够确认发送方的身份是真实的，并且所发送的信息都是经过加密的，我们依然不能认为网络是安全的。还必须确认所收到的信息都是完整的，也就是信息的内容没有被人篡改过。
4. 运行的安全性
现在的机构与计算机网络的关系越密切，就越要重视计算机网络运行的安全性。
访问控制（access control)对计算机系统的安全性非常重要。必须对访问网络的权限加以控制，并规定每个用户的访问权限。
## 两类密码体制
### 对称密钥密码体制
所谓对称密钥密码体制，即加密密钥与解密密钥都使用相同密钥的密码体制
### 公钥密码体制
公钥密码体制使用不同的加密密钥与解密密钥。这种加密体制又称为非对称密钥密码体制
在公钥密码体制中，加密密钥 PK (Public Key,即公钥）是向公众公开的，而解密密SK (Secret Key,即私钥或密钥）则是需要保密的。加密算法 和解密算法 也都是公开的
只能单向保密
## 鉴别
### 报文鉴别
鉴别(authentication) 是网络安全中一个很重要的问题。鉴别的内容有二。一是要鉴别发信者，即验证通信的对方的确是自己所要通信的对象，而不是其他的冒充者。二是要鉴别报文的完整性，即对方所传送
的报文没有被他人篡改过。
1. **用数字签名进行鉴别（原理）**
私钥做数字签名
<img srcc="img\屏幕截图 2022-12-09 212827.png">

2. **密码散列函数**

# 无线网络和移动网络
## 无线局域网 WLAN
### 无线局域网的组成
第一类是有基础设施的，第二类是无基础设施的。

1. **IEEE 802.11** 
对于第一类有基础设施的无线局域网， 1997 IEEE 制定出无线局域网协议 802.11 系列标准。 
802.11 就是无线以太网的标准，它使用星形拓扑。无线局域网的中心叫作接入点 AP (Access Point),它是无线局域网的基础设施，也是
一个链路层的设备。所有在无线局域网中的站点，对网内或网外的通信，都必须通过接入点 AP 。
802.11 无线局域网的 MAC 层使川 CSMA/CA 协议。现在802.11 系列标准的无线局域网常称为 Wi-Fi。

802.11 标准规定无线局域网的砐小构件是基本服务集 BSS (Basic Servvice Set)。一个基本服务渠 BSS 包括一个接入点和若干个移动站。各站在本 BSS 以内之间的通信，或者与外部站点的通信，都必须通过本 BSS 的搂入点。当网络管理员安装 AP 时，必须为该 AP 分配
一个不超过 32 字节的服务集标识符 SSID (Service Set IDentifi er)” 和一个通信信道。 SSID是指使用该 AP 的无线局域网的名字。 SSID 
—个基本服务集 BSS 所覆盖的地理范围叫作一个基本服务区 BSA (Basic Service Area) 。在网络通信中，链路层设备的唯一标志是
MAC 地址。接入点 AP 在出厂时就已有了一个唯 48 位二进制数字的 MAC 地址，其正式名称是基本服务集标识符 BSSID 。在无线局域网中传送的各种帧的首部中，都必须有节点的 MAC 地址（即 BSSID, 但不是 SSID) 。请不要把 BSSID SSlD 弄湿。用户通常都知道所连接的无线局域网的名 SSTD, 但可以不知道其 MAC 地址 BSSID
无线局域网通常使用的频段2.4 GHz和5 GHz 频段。每一个频段又再划分为若干个信道，供各无线局域网使用。

一个基本服务集可以是孤立的单个服务集，也可通过接入点 AP 连接到一个分配系统DS (Distribution System), 然后再连接到另一个基本服务集，这样就构成了一个扩展服务集ESS (Extended Service Set)。 ESS 也有个标识符，是不超过 32 字符的字符串名字而不是地址，叫作扩展服务集标识符 ESSID 。
<img src="img\屏幕截图 2022-12-09 215030.png">

移动站与接入点 AP 建立关联的方法有两种。一种是被动扫描（如图 9-2(a) 所示），其过
程如下：
接入点 AP 周期性发出（例如每秒 10 次）信标帧(beacon frame), 其中包含有若干系统参数（如服务集标识符 SS[D 以及支持的速率等）。

移动站 扫描 ll 个信道，选择厄意加入接入点 AP2 所在的基本服务渠 BSS2, 于是AP2 发出关联请求帧(Assoc ti on Request frame)
接入点 AP2 同意移动站 发来的关联请求，向移动站 发送关联响应帧(AssociationResponse frame)

另一种建立关联的方法是主动扫描
<img src="img\屏幕截图 2022-12-09 220629.png">

若移动站使用重建关联（reassociation)服务，就可把这种关联转移到另一个接入点。当使用分离（小ssoc ti on)服务时，就可终止这种关联。
2. **移动自组网络**
另一类无线局域网是无固定基础设施的无线局域网，它又叫作自组网络 (ad hoxnetnwork) 。这种自组网络没有士述基本服务集中的接入点 AP, 而是由一些处于平等状态的移动站相互通信组成的临时网络.
自组网络通常是这样构成的：一些可移动的设备发现在它们附近还有其他的可移动设备，并且要求和其他移动设备进行通信
<img src="img\屏幕截图 2022-12-09 221145.png">

### 802.11 局域网的物理层
隐蔽站问题
<img src="img\屏幕截图 2022-12-10 075659.png">

802.11 局域网使用 CSMA/CA 协议'。 CA 表示 Collison Avoidance, 是碰撞避免的总思，或者说，协议的设计是要尽量减少碰撞发生的概率。这点和使用有线连接的以太网有很大的区别。以太网当然不希望发生碰撞，但并不怕发生碰撞，因为碰撞的影响并不大。
局域网在使用 CSMA/CA 的同时，还使用停止等待协议。收到上一帧的确认，才能发送下一帧。

### 802.1 局域网的 MAC 层协议
1. **CSMA/CA** 
<img src="img\屏幕截图 2022-12-10 080557.png">

(I) 分布协调功能 DCF (Dis1ributed Coordination Function) DCF 不采用任何中心控制，让各站通过争用信道来获取发送权。即短帧间间隔 SIFS (Short Inter-Frame Spaceing)和分布协调功能帧间间隔 DIFS (DCF IFS) 
(2) 点协调功能 PCF (Point Coordination Function) PCF 是选项，是用接入点 AP 集中控制整个 BSS 内的活动， PCF 使用集中控制的接入算法，用类似于探询的方法把发送数据权轮流交给各个站，从而避免了碰撞的产生。
CSMA/CA 协议的特点如下：
(I) 站点想发送数据必须先监听信道。若信道在时间间隔 DIFS 内均为空闲，则发送整个数据帧。否则，进行(2)
(2) 站点选择一随机数，设置退避计时器。计时器的运们规则是：若信道忙，则冻结退避计时器，然线等待，直至信道变空闲。若信道空闲，并在时间间隔DIFS 内均为空闲，开始争用信道，当退避计时器时间减为零时，发送数据。
(3) 站点若收到接收方发来的确认帧，且还有后续帧要发送，就转到（2) 。若在设定时间内未收到确认，则准各重传，并转到（2), 但会在更大的范围内选择一随机数。
2. **时间间隔 DIFS 的重要性**
<img src="img\屏幕截图 2022-12-10 082510.png">

第一个方法是用软件实现的虚拟载波监听（ irtual Carrier Sense) 的机制。这就是让源把要占用信道的时间, 以微秒为单位，写入其数据帧 DATA的首部。广播播范围内的各站，都能够收到这一信息，并创建自己的网络分配向量 NAV (Network Allocation Vector)
第二个方法是在物理层用硬件实现载波监听。每个站检查收到的信号强度是否超过一定的门限数值，用此判断是否有其他移动站在信道上发送数据。
3. **争用信道的过程**

4. **对信道进行预约**
为了更好地解决隐蔽站带来的碰撞问题， 802.11 允许要发送数据的站对信逆进行预约。
<img src="img\屏幕截图 2022-12-10 092543.png">

### 802.11 局域网的 MAC帧
控制帧、数据帧和管理帧
<img src="img\屏幕截图 2022-12-10 093427.png">

地址1永远是接收地址（即直接接收数据帧的节点地址）。
地址2永远是发送地址（即实际发送数据帧的节点地址）。

地址3和地址4取决于数据帧中的”来自 AP" 和“去往 AP" 这两个字段的数值。
1. **关于 802.11 数据帧的地址**
## 无线个人区域网 WPAN
无线个人区域网 WPAN (Wireless Personal Area Network)就是在个人工作的地方把屈于个人使用的电子设备（如便携式电脑、平板电脑、便携式打印机以及蜂窝电话等）用无线技术连接起来自组网络
1. **蓝牙系统**

蓝牙使用 TDM 方式和跳频扩频 FHSS 技术．组成不使用接入点 AP 的皮可网(piconet)。piconet的意思就是“微微网”，因表示这种无线网络的覆盖面积积非常小。每一个皮可网有一个主设备(Master)和最多7个工作的从设备(Slave) 。通过共享主设备或从设备，可以把多个皮可网链接起来，形成一个范闱更大的扩散网（scatternet)。
<img src="img\屏幕截图 2022-12-10 094503.png">

2. **低速 WPAN**
ZigBee 作为新一代无线通信技术的名称。 ZigBee 技术主要用于各种电子设备（固定的、便携的或移动的）之间的无线通信，其主要特点是通信距离短 (10~80 m), 传输数据速率低，并且成本低廉。
ZigBee 网络容量大。一个 ZigBee 的网络最多包括有 255 个节点，其中一个是主设备(Master), 其余则是从设备（Slave) 。若是逌过网络协调器(Network Coordinator), 整个网络最
多可以支持超过 64000 个节点。
ZigBee 的节点按功能的强弱可划分为两大类，即全功
能设备 FFD (Full-Function Device)和精简功能设备 RFD (Reduced-Function Device). RFD点是 ZigBee 网络中数侦最多的端设备，它的电路简单，存储容泣较小，因而成本较低。 FFD 节点具备控制器（Controller) 的功能，能够提供数据交换，
<img src="img\屏幕截图 2022-12-10 095031.png">

3. **高速 WPAN**
高速 WPAN 的标准是 IEEE 802.15.3, 是专为在便携式多媒体装置之间传送数据而制定的。这个标准支持 11~55 Mbit/ 的数据率

## 蜂窝移动通信网
### 蜂窝无线通信技术的发展简介
1. **蜂窝移动通信系统问世**
最早的第一代(IG) 蜂窝移动通信系统l978 年, 它使用用*模拟技术*和传统的*电路交换*及*频分多址* FDMA 提供电话服务。这里的 表示 Generation （代）
2. **2G 蜂窝移动通信系统**
蜂窝移动通信的特点
<img src="img\屏幕截图 2022-12-10 095558.png">

把不同的小区划分，建基站，不同的基站可以实现频率复用

GSM 系统出然使用数字技术，但仍然使用传统的电路交换提供语音通信服务。
移动用户到且站之间的空口（即无线空中按门）采用的多址方式是 FDMA/TDMA 的混合系统。这种混合系统先按频分复用力式，把可用频带（上下行行各占用 25 MHz) 划分为125 个带宽为 200 kHz 的子频带。然后把每个频带进行时分复用，
核心网包括移动交换中心 MSC (Mobile Switching Center) 和网关移动交换中心 GMSC(Gateway Mobile Switching Center) MSC 的重要任务是负责用户的授权和账单（即确定是台允许一个移动设备接入到这个蜂窝网络中），用户呼叫连接的建立和释放
3. **数据通信披引入移动通信系统**
GSM 初期以提供话音为主，在中后期为了满足移动数据汕信需求，引入通用分组无线服务 GPRS (General Packet Radio Service) （俗称 2.SG) 和增强型数据速率 GSM 演进 EDGE(Enhanced Data rate for GSM Evolution) （俗称 2.75G)) 系统
<img src="img\屏幕截图 2022-12-10 103244.png">

3. **3G 蜂窝移动通信系统**
3G UMTS 引入了无线接入网的概念，其全名是通用移动通信系统陆地无线接入网 UTRAN (UMTS Terrestrial Radio Access Network), 它由多个无线网络系统组成。每个无线网络系统有－个无线网络控制器 RNC (Radio Netwvork Controller)和许多基站，
3G UMTS 2G GSM 的主要区别集中在 UTRAN 侧，在空门使用直接序列宽带码分多址 DS-WCDMA (Direct Sequence Wideband CDMA), 或时分同步码分多址 TD-SCOMA(Time Division-Synchronous Code Division Multiple Access) 。
<img src="img\屏幕截图 2022-12-10 103906.png">

5. **4G 蜂窝移动通信系**
MT-Advanced 的一个最重要的特点就是取消了电路交换，无论传送数据还姑传送话齿，全部使用分组交换技术，或称为全网 IP 化。 
<img src="img\屏幕截图 2022-12-10 104156.png">

3GPP R8 版本发布的长期演进 LTE (Long-Term Evolution)准

LTE 的体系结构三大部分组成，即用户设备 UE 、演进的无线接入网 E-UTRAN(Evolvcd-UTRAN) 和演进的分组核心网 EPC (Evolved Packet Core）

基站eNB有三个主要构件 1 天线 2 无线模块：对发往空的信号，或从空口接受信号，进行调制或解调 3 数字模块 作为空口于核心网的接口

在控制层面，基站eNB负责无线资源的管理，执行又MME发起的寻呼信息的的调度和传输，并为UE发往服务网关S-GW的数据选择路由。在数据层面，基站eNB在用户设备UE与核心网之间传送IP数据包。分组数据网络网关（简称为分组网关） P-GW (Packet Data Network GateWay)是核心网通向互联网的网关路由器或边界路由器。

**分组数据网络网关**（简称为分组网关） P-GW (Packet Data Network Gate Way)是核心网通向互联网的网关路由器或边界路由器，


**服务网关** S-GW (Serving GateWay)是无线接入网与核心网之间的网关路由器，S-GW 负责用户层训的数拟分组的转发和路由选择，起到路由器的作用。 


**归属用户服务器** ISS (Home Subscriber Server) 是个中心数据库，里面有网络运营商所保存的用户的基本数据
**移动性管理实体** MME (Mobility Management Entity)是一个信令实体，负责基站与核心网之间以及用户与核心网之间的所有信令交换 

### LTE 网络与互联网的连接

UE（如手机）开机后，就登记到 LTE 网络，以便使用网络资源来传送 IP数据业务。在 LTE 网络内的数据路径由两大部分组成，即空空口无线链路 (UE eNB) 和核心网中的隧道 (eNB - S-GW - P-GW) 。
<img src="img\屏幕截图 2022-12-10 114154.png">

